!function(e,t,a){"use strict";console.log("script.js 20Feb2018");var i="add-field",s={click:"click."+i};function n(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}n.prototype={init:function(){var t=this,a=t.options;t.initDom(),t.btnAddField.off(s.click).on(s.click,function(e){e.preventDefault(),t.elem.siblings().length<a.maxItem&&t.elem.parent().append(t.cloneTemplate.clone())}),t.elem.parent().off(s.click,t.classRemoveField).on(s.click,t.classRemoveField,function(t){t.preventDefault(),e(this).parent().remove()})},initDom:function(){var t=this.options;this.elem=this.element,this.btnAddField=e("."+t.classAddField,this.elem),this.classRemoveField="."+t.classRemoveField,this.cloneTemplate=this.elem.clone(),e("label",this.cloneTemplate).hide(),e("."+t.classAddField,this.cloneTemplate).removeClass(t.classAddField).addClass(t.classRemoveField).html("X")},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var s=e.data(this,i);s?s[t]&&s[t](a):e.data(this,i,new n(this,t))})},e.fn[i].defaults={maxItem:10,classAddField:"btn-add-field",classRemoveField:"btn-remove-field"},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="add-services",s=!1,n=Site.vars.assetPath,o={click:"click."+i,change:"change."+i,keyup:"keyup."+i,beforeunload:"beforeunload"},d=function(e){var t=e.confirm?'<button class="btn btn-default '+e.confirm.class+' margin-left-xxs" type="button" data-toggle="modal" data-dismiss="modal" data-id="'+e.confirm.id+'">'+e.confirm.title+"</button>":"",a=Site.vars.bodyElem.find("[data-id=common-popup]");a.html('<div class="modal-dialog partial-screen-modal-dialog"><div class="modal-content overflow-auto"><div class="modal-header bg-t2"><button class="modal-header-btn pull-left" data-dismiss="modal"><svg class="icon-xs hide-on-fallback" role="img" title="closewhite-glyph"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#closewhite-glyph"></use><image class="icon-fallback" alt="closewhite-glyph" src="'+n+'closewhite-glyph.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>  </button><h6 class="w text-center">'+e.title+'</h6></div><div class="modal-container padding-top-xxl content-centering"><p class="content-centering bt2">'+e.description+'</p><div class="margin-bottom-l margin-top-xxl"><button class="btn btn-default '+e.decline.class+'" type="button" data-dismiss="modal" data-id="'+e.decline.id+'">'+e.decline.title+"</button>"+t+"</div></div></div></div>"),a.off("hidden.bs.modal").on("hidden.bs.modal",e.decline.func),e.confirm&&Site.vars.bodyElem.off(o.click,"[data-id="+e.confirm.id+"]").on(o.click,"[data-id="+e.confirm.id+"]",e.confirm.func),a.modal("show")},r=function(){Site.vars.winElem.unbind(o.beforeunload),setTimeout(function(){d({title:"WARNING",description:"Please try to Save the document again.",decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){}}})},350)};function l(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}l.prototype={init:function(){var a=this;t.endPointApi=a.element.data("end-point-api"),a.statusTitle={editAdd:"proceed",editCompleted:"Edit More",editIncomplete:"Edit To Complete",statusCompleted:"Form Completed",statusIncomplete:"Incomplete",statusAdd:"Added",remove:"remove",draft:"draft",completed:"completed",inProgress:"In-Progress"},a.initDom(),a.posSubmitRef=this.element.data("submit-ref"),a.currentStep=1,a.maxSelect=10,a.countSelectSR=0,a.exceptList=["SR080","SR077","SR021"],a.arrayServicesTemp=[],a.arrayServices=[],a.isCreatingSR=!1,a.trigger={cka:{loadForm:!1},srCodeEdd:"SR021",srCodeFatca:"SR077",srCodeCrs:"SR080"},a.authorType={signature:"Signature",aia2fa:"AIA2FA",onekeySMS:"OneKeySMS",onekeyToken:"OneKeyToken"},a.paramsSubmit={},a.otpInfo={},a.isTokenLinked=!1,a.witnessData={},a.submitionStatus=!1,a.targetOrgin=t.location.origin,Site.vars.winElem.off(o.beforeunload).on(o.beforeunload,function(){return!0}),e("[data-id=save-draft]").off(o.click).on(o.click,function(i){i.preventDefault();var s=e(this).attr("href");a.saveAsDraftAction(function(){if(Site.vars.winElem.unbind(o.beforeunload),a.currentStep>5)return t.location.replace(s),!1;d({title:"MESSAGE",description:"Saved as Draft. Your draft will be saved for 30 days and remains editable for 30 days.",decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){t.location.replace(s)}}})})}),a.modalSignatureVerified.off("hidden.bs.modal").on("hidden.bs.modal",function(e){e.preventDefault(),!1===a.submitionStatus&&a.submitionFinal(a.paramsSubmit)}),a.initMethod(),Site.checkPermission("srp_save_as_draft",function(){a.element.find("[data-id=submit-services]").remove(),a.btnCancelRequest.remove(),a.btnSaveAsDraft.remove(),a.saveAsDraftAction=function(){},Site.vars.winElem.unbind(o.beforeunload)})},initDom:function(){this.leftServiceRequest=this.element.find("[data-id=left-service-request]"),this.selectItem=this.leftServiceRequest.find("[data-id=list-select-request]"),this.customerInfo=this.leftServiceRequest.find("[data-id=customer-info]"),this.rightServiceRequest=this.element.find("[data-id=right-service-request]"),this.warpStep=this.rightServiceRequest.find("[data-id=content-request]"),this.step1=this.warpStep.find("[data-step=1]"),this.filterSearch=this.step1.find("[data-id=filter-form]"),this.selectSearch=this.step1.find("[data-id=frequent-field-dropdown]"),this.inputSearch=this.step1.find("input[type=text]"),this.ListContainer=this.step1.find("[data-id=request-content] ul"),this.btnShowMoreStep1=this.step1.find("[data-id=show-more]"),this.formRequest=this.step1.find("[data-id=form-request]"),this.listRequest=this.step1.find("[data-id=list-request]"),this.loadingAllPage=e(".loading"),this.step2=this.warpStep.find("[data-step=2]"),this.step3=this.warpStep.find("[data-step=3]"),this.step4=this.warpStep.find("[data-step=4]"),this.step5=this.warpStep.find("[data-step=5]"),this.step6=this.warpStep.find("[data-step=6]"),this.modalSignatureVerified=e("#addon-modal-signature-verified"),this.modalSignatureCancel=e("#addon-modal-signature-cancel"),this.modalSMSVerified=e("#addon-modal-sms-verified"),this.modalError=e("#addon-modal-proccess-error"),this.modalOnkey=e("#addon-modal-onekey"),this.hardwareOnekey=e("#addon-modal-onekey-pin"),this.smsOnekey=e("#addon-modal-onekey-sms"),this.modalOnkeyVerified=e("#addon-modal-onekey-verified"),this.smsOnekeyLink=e("#addon-modal-onekey-sms-link"),this.hardwareOnekeyLink=e("#addon-modal-onekey-pin-link"),this.modalOnkeyNoActDevice=e("#addon-modal-onekey-not-device"),this.modalOnkeyAgreeLinkDevice=e("#addon-modal-onekey-agree-link-device"),this.modalaiaOTP=e("#addon-modal-aia-sms"),this.modalRemote=e("#addon-modal-remote"),this.modalResendPdf=e("#addon-modal-resend-pdf"),this.modalRemoteComplete=e("#addon-modal-remote-complited"),this.modalSendPdfComplete=e("#addon-modal-send-pdf-complited"),this.closeModal=e('[data-id="close"]'),this.loading=this.rightServiceRequest.find("[data-id=loading-processing-bar]"),this.loadingPage=this.rightServiceRequest.siblings("[data-id=loading-processing-bar]"),this.btnSaveAsDraft=this.element.find("[data-id=save-and-draft]"),this.btnCancelRequest=this.element.find("[data-id=cancel-request]"),this.template={customerInfo:'{{#if posPolicyNumber}}<p class="h5 margin-bottom-s customer-title">{{LabelPolicyId}}</p><div class="thumbnail margin-bottom-l"><svg class="icon-m hide-on-fallback" role="img" title="mypolicy-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#mypolicy-prime1"></use><image class="icon-fallback" src="'+n+'icons/mypolicy-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg><div class="thumbnail-text"><h5 class="title-text">{{posPolicyNumber}}</h5><p class="bt4">{{policyResponse.planName}}</p></div></div><p class="h5 margin-bottom-s customer-title">{{LabelPolicyOwner}}</p><div class="thumbnail">{{#ifEquals policyHolderGender "M"}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#malepressed-prime1"></use><image class="icon-fallback" src="'+n+'icons/malepressed-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{else}}<svg class="icon-m hide-on-fallback" role="img" title="icon-life-primary"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#femalepress-prime1"></use><image class="icon-fallback" src="'+n+'icons/femalepress-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}<div class="thumbnail-text"><h5 class="title-text">{{policyHolderName}}</h5><p class="bt4">{{policyHolderID}}</p></div></div>{{else}}<p class="h5 margin-bottom-s customer-title">{{Labelcustomer}}</p><div class="thumbnail">{{#ifEquals policyHolderGender "M"}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#malepressed-prime1"></use><image class="icon-fallback" src="'+n+'icons/malepressed-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{else}}<svg class="icon-m hide-on-fallback" role="img" title="icon-life-primary"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#femalepress-prime1"></use><image class="icon-fallback" src="'+n+'icons/femalepress-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}<div class="thumbnail-text"><h5 class="title-text">{{policyHolderName}}</h5><p class="bt4">{{policyHolderID}}</p></div></div>{{/if}}',selectItem:'{{#each .}}<div data-sr-code="{{srCode}}" data-submit-ref="{{submitSRRef}}" class="select-item padding-top-xxs padding-bottom-xxs margin-bottom-xs"{{#ifNotEquals srCode "sr077"}} {{#ifEquals FATCAInd "Y"}} data-fatca="{{FATCAInd}}" {{/ifEquals}} {{/ifNotEquals}}{{#ifNotEquals srCode "sr080"}} {{#ifEquals CRSInd "Y"}} data-crs="{{CRSInd}}"{{/ifEquals}} {{/ifNotEquals}}{{#ifNotEquals srCode "sr021"}} {{#ifEquals EDDInd "Y"}} data-edd="{{EDDInd}}" {{/ifEquals}} {{/ifNotEquals}}{{#ifEquals CKAInd "Y"}} data-cka="{{CKAInd}}" {{/ifEquals}}data-parent-submit="{{parentSRSubmitRef}}"{{#each listparentSRSubmitRef}} data-parent-sr-submit-ref-{{ this }}=""{{/each}} data-parent-sr-submit-ref-count="{{listparentSRSubmitRef.length}}"><div class="select-top"><div class="thumbnail progress-thumbnail margin-bottom-xxs">{{#ifEquals submitStatus "draft" }}{{#if ckaData}}<div class="progress-ring"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{iconRing}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconRing}}"></use><image class="icon-fallback" src="{{iconRing}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div><div class="progress-glyph"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{iconCenter}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconCenter}}"></use><image class="icon-fallback" src="{{iconCenter}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div>{{else}}{{#ifEquals formData ""}}<div class="progress-ring"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="grey0-ring"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#grey0-ring"></use><image class="icon-fallback" src="grey0-ring.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div><div class="progress-glyph"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="edit-2ndg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#edit-2ndg"></use><image class="icon-fallback" src="edit-2ndg.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div>{{else}}<div class="progress-ring"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{iconRing}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconRing}}"></use><image class="icon-fallback" src="{{iconRing}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div><div class="progress-glyph"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{iconCenter}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconCenter}}"></use><image class="icon-fallback" src="{{iconCenter}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div>{{/ifEquals}}{{/if}}{{else}}<div class="progress-ring"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{iconRing}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconRing}}"></use><image class="icon-fallback" src="{{iconRing}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div><div class="progress-glyph"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{iconCenter}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconCenter}}"></use><image class="icon-fallback" src="{{iconCenter}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div>{{/ifEquals}}</div><div class="select-text"><h5 class="title-text">{{srDescription}}</h5>{{#ifEquals submitStatus "draft" }}{{#if ckaData}}<p class="bt4 p2" data-id="status">'+this.statusTitle.statusIncomplete+'</p>{{else}}{{#ifEquals formData ""}}<p class="bt4 p2" data-id="status">'+this.statusTitle.statusAdd+'</p>{{else}}<p class="bt4 p2" data-id="status">'+this.statusTitle.statusIncomplete+'</p>{{/ifEquals}}{{/if}}{{/ifEquals}}{{#ifEquals submitStatus "completed" }}<p class="bt4 p2" data-id="status">'+this.statusTitle.statusCompleted+'</p>{{/ifEquals}}</div></div>{{#checkPermission "srp_save_as_draft"}}<ul class="action-list nav"><li><a class="select-proceed" href="#" data-id="select-proceed"><svg class="icon-xs icon-64 hide-on-fallback" role="img" title="edit-2ndg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#edit-2ndg"></use><image class="icon-fallback" src="'+n+'icons/edit-2ndg.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{#ifEquals formData ""}}<span class="h6">'+this.statusTitle.editAdd+'</p>{{else}}<span class="h6">{{editText}}</p>{{/ifEquals}}</a></li><li><a class="select-remove" href="#"><svg class="icon-xs icon-64 hide-on-fallback" role="img" title="erase-2ndg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#erase-2ndg"></use><image class="icon-fallback" src="'+n+'icons/erase-2ndg.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg><span class="h6">'+this.statusTitle.remove+"</p></a></li></ul>{{/checkPermission}}</div>{{/each}}",attachment:'{{#each .}}<li class="padding-top-xxl padding-bottom-xxl" data-id="attachments" data-submit-sr-ref="{{submitSRRefs}}" data-attachment-id="{{id}}"><div class="icon-wrapper">{{#ifEquals type "document"}}<svg class="icon-xs hide-on-fallback" role="img" title="claim-2nd"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#claim-2nd"></use><image class="icon-fallback" alt="claim-2nd" src="'+n+'claim-2nd.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{else}}<svg class="icon-xs hide-on-fallback" role="img" title="money-2nd"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#money-2nd"></use><image class="icon-fallback" alt="money-2nd" src="'+n+'money-2nd.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}</div><div class="text-wrapper"><h5 class="margin-bottom-m title">{{name}}</h5><p class="margin-bottom-xs description">{{desc}}</p>{{#checkPermission "srp_save_as_draft"}}<ul class="action-list nav"><li><a class="select-proceed" href="#" data-id="upload-file"><img class="icon-xs" alt="upload-file" src="'+n+'icons/upload-file.png"><span class="h6">upload file</span></a></li><li><a class="select-remove" href="#" data-id="take-picture"><img class="icon-xs" alt="take-photo" src="'+n+'icons/take-photo.png"><span class="h6">take a photo</span></a></li></ul>{{/checkPermission}}<div class="margin-top-xxl uploaded-file-section"><h5 data-id="uploaded-list" {{#ifEquals files.length 0}}class="hidden"{{/ifEquals}}>Files Uploaded</h5><ul class="uploaded-files">{{#files}}<li><input type="file" class="hidden" name="invoice[]"><a class="lk2" data-id="uploaded-file" data-file-ref="{{fileRef}}" href="'+t.endPointApi+"{{url}}?j="+Site.getCookie("jbSessionId")+"&t="+Site.getCookie("jwtToken")+"&s="+Site.getCookie("sessionInfo")+'" target="_blank">{{name}}</a>{{#checkPermission "srp_save_as_draft"}}<button class="remove-button" type="button" aria-label="Remove" data-id="remove-file"><span aria-hidden="true">×</span></button>{{/checkPermission}}</li>{{/files}}</ul>{{#ifNotEquals name "others"}}<p class="margin-top-m u2 hidden" data-id="validate-upload">Please upload at least 1 file</p>{{/ifNotEquals}}<p class="margin-top-m bt3 p1 hidden" data-id="processing-upload">Processing ...</p></div></div></li>{{/each}}',itemListRequest:'<p class="margin-top-m u2 hidden" data-id="no-result-sr">No POS Request match with your filter.</p>{{#each .}}<li class="{{#ifEquals srDisplayInd "N"}}hidden{{/ifEquals}}{{#if disabledStt}} disabled{{/if}}" ><div class="content"><div class="add-on-details"><div class="add-on-checkbox"><label class="checkbox" for="{{srCode}}"><input id="{{srCode}}" type="checkbox" name="{{srCode}}" value="{{srDescription}}"{{#if statusCheck}} checked {{/if}}{{#if disabledStt}} disabled {{/if}}><span class="indicator"><span class="tick"></span></span><span class="indicator"><span class="tick"></span></span><h5>{{srDescription}}</h5></label></div><div class="add-on-text">{{#ifEquals remoteAuthInd "Y"}} This request supports Remote Authentication{{#ifEquals srCode "SR001"}} only for <strong><u>Non Healthshield Policies</u></strong>{{else}}{{#ifEquals srCode "SR007"}} only for <strong><u>Non Healthshield Policies</u></strong>{{/ifEquals}}{{/ifEquals}}. {{else}} {{#ifEquals sgnatureAuthInd "Y"}} This request requires Signature Authentication. {{/ifEquals}}{{/ifEquals}}</div></div></div></li>{{/each}}',wapperStepThree:'{{#each.}}<div class="radio-button margin-bottom-m" for="{{id}}"><div class="radio-check"><span class="indicator"></span></div><div class="add-on-text"><div class="bt3">{{{content}}} </div></div></div>{{/each}}',reviewSTepFour:'{{#each .}}<div class="review"><div class="heading"><div class="thumbnails"><img src="'+n+'images/logos/logo-view.png" alt="logo aia"/></div><div class="content"><h4>Aia Singapore</h4></div></div><div class="row"><div class="col-sm-12"><p class="bt8 margin-top-m w bg-k padding-left-xxs margin-bottom-m">Termination Policy</p></div></div><div class="row margin-bottom-xl"><div class="col-sm-12"><p class="bt3 b5 margin-bottom-xs">Insured Name: {{fullNm}}</p><p class="bt3 b5 margin-bottom-xs margin-bottom-l">Account No.: {{idNum}}</p><div class="review-checkbox margin-bottom-m"><div class="icon-checkbox checked"></div><span>{{checkboxName}}</span></div><p class="bt3"><em>{{description}}</em></p></div></div>{{/each}}',methodStepFiveTitle:'<div class="row"><div class="col-sm-12">{{#ifEquals this "directAuth"}}<p class="margin-bottom-l">Your client is right next to you.</p>{{else}}<p class="margin-bottom-xs margin-top-s">Your client is not with you now.</p>{{/ifEquals}}</div></div>',methodStepFiveAuth:'<div class="row text-center">{{#each .}}{{#ifEquals type "oneKey"}}<div class="col-sm-4 col-md-3" data-type="{{type}}">{{else}}<div class="col-sm-4 col-md-3" data-type="{{type}}">{{/ifEquals}}<div class="bare-item"><div class="bare-thumbnail text-center"><img src="'+n+'images/{{type}}.jpg" alt="{{type}}"></div><h6 class="bare-h4 p3 text-center">{{name}}</h6></div></div>{{/each}}</div>',templateLastStep:'<div data-title-step6 class="data-content completed-pos margin-bottom-l"><div class="select-list"><div class="select-item padding-top-xxs padding-bottom-xxs margin-bottom-xs" data-id="check-1"><div class="select-top"><div class="thumbnail progress-thumbnail"><div class="progress-ring"><svg class="icon-m hide-on-fallback" role="img" title="{{iconRing}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconRing}}"></use><image class="icon-fallback" alt="{{iconRing}}" src="'+n+'icons/{{iconRing}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div><div class="progress-glyph"><svg class="icon-s icon-64 icon-m hide-on-fallback" role="img" title="{{iconCenter}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{iconCenter}}"></use><image class="icon-fallback" alt="{{iconCenter}}" src="'+n+'icons/{{iconCenter}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div></div><div class="select-text"><div class="title-text bt1">{{titleStatus}}: {{{lastUpdatedOnSubmit}}}</div>{{#ifEquals submitStatus "pending"}}<a class="s5 bt3" href="#" data-resend-authorize-btn="true" title="Send e-mail and SMS Again?">Send e-mail and SMS Again?</a>{{/ifEquals}}{{#ifEquals submitStatus "submitted"}}<a class="s5 bt3" href="#" data-resend-email-btn="true"  title="Send the PDF to customer">Send the PDF to customer</a>{{/ifEquals}}</div></div></div></div>{{#ifEquals submitStatus "rejected"}}{{#if rejectReason}}<h6 class="margin-top-m margin-bottom-m">REASON FOR REJECTION</h6><div class="bt3 padding-xxs border">{{{rejectReason}}}</div>{{/if}}{{/ifEquals}}</div>'}},initMethod:function(){var e=this;e.loadPageServiceRequest(),e.saveAsDraft(),e.cancelRequest(),e.initNextPrevButton("next"),e.initNextPrevButton("previous"),e.parentListener()},loadAjaxResubmitForm:function(e,a,i){var s=this,n=s.options;s.loadingPage.removeClass(n.hidden),Site.ajaxUtil(a?s.options.urlCancelLinkToken:s.options.draftUrl,s.options.method,"json",JSON.stringify(e),function(e){200===e.statusCode&&(Site.vars.winElem.unbind(o.beforeunload),t.location.reload()),s.loadingPage.addClass(n.hidden),"function"==typeof i&&i(e.message)},function(e){throw s.loadingPage.addClass(n.hidden),"function"==typeof i&&i(e.message),e})},resubmitForm:function(){var e=this,t=e.element.find("[data-id=re-submit]"),a=e.element.find("[data-id=cancel-submit]"),i=e.element.find("[data-last-submit]"),s=Site.getSessionInfo()||{},n=e.dataPos.submitStatus.toLowerCase(),r="FSC"===s.userType&&s.agent.agentClass>29,l=!1;"rejected"===n||"expired"===n?t.removeClass("hidden"):"pending"===n&&(a.removeClass("hidden"),l=!0),e.editable||i.attr("disabled",!0),i.off(o.click).on(o.click,function(t){t.preventDefault();var a={submitRef:e.posSubmitRef,currentStep:1,submitStatus:"draft"};if("rejected"!==n&&"expired"!==n&&"pending"!==n||!r||(e.editable=!0),!e.editable)return!1;var i="Are you sure you want to re-submit Pos request?";l&&(i="Are you sure you want to cancel Pos request?"),d({title:"NOTICE",description:i,confirm:{id:"confirm",title:"confirm",class:"btn-secondary",func:function(){e.loadAjaxResubmitForm(a,l,function(e){setTimeout(function(){d({title:"Error Message",description:e,decline:{id:"",title:"Close",class:"btn-primary",func:function(){}}})},250)})}},decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){}}})})},initButton:function(){var t=this,a=t.options,i=t.leftServiceRequest.find("[data-next-step]"),s=t.leftServiceRequest.find(a.btnPrevious),n=t.leftServiceRequest.find("[data-last-step]"),o=t.leftServiceRequest.find("[data-last-submit]");t.currentStep>=2?s.removeClass("hidden"):!s.hasClass("hidden")&&s.addClass("hidden"),e.each(i,function(a){a+1===t.currentStep?e(i[a]).removeClass("hidden"):!e(i[a]).hasClass("hidden")&&e(i[a]).addClass("hidden")}),t.currentStep>5&&(e(n).removeClass("hidden"),e(o).siblings("button").addClass("hidden"))},saveAsDraftAction:function(t){var a=this,i=a.options,s={submitRef:a.posSubmitRef,currentStep:a.currentStep};if(a.currentStep>5)"function"==typeof t&&t();else if(a.formRequest.find("iframe").length)a.formRequest.find("iframe")[0].contentWindow.postMessage({message:"saveAsDraft"},a.targetOrgin),"function"==typeof t&&t();else{if(3===a.currentStep){var n=[];e.each(e("#declaration").serializeArray(),function(e,t){n.push(t.name)}),s.declarations=n.toString()}Site.ajaxUtil(i.draftUrl,i.method,"json",JSON.stringify(s),function(e){200!==e.statusCode?r():"function"==typeof t&&t()},function(e,t){throw t&&0===t.status&&r(),e})}},initNextPrevButton:function(t){var a=this;a.leftServiceRequest.find("[data-"+t+"-step]").off(o.click).on(o.click,function(){var i=e(this).siblings("[type=button]:visible").prop("disabled",!0),s=e(this).prop("disabled",!0);a.currentStep="next"===t?a.currentStep+=1:a.currentStep-=1,a.saveAsDraftAction(function(){a.setCurrentStep(a.currentStep),a.initButton(),a.showStep(t),i.prop("disabled",!1),s.prop("disabled",!1)})})},parentListener:function(){var a=this,i=[],n=function(t){var s,n,o=a.formRequest.find(".aemform").data("sr-code");if(n={FATCAInd:"N",CRSInd:"N",EDDInd:"N"},i=[],(s=t).trigger&&(e.each(s.trigger,function(e,t){"fatca"===t.srCode&&(n.FATCAInd=t.value?"Y":"N",t.srCode=a.trigger.srCodeFatca),"crs"===t.srCode&&(n.CRSInd=t.value?"Y":"N",t.srCode=a.trigger.srCodeCrs),"edd"===t.srCode&&(n.EDDInd=t.value?"Y":"N",t.srCode=a.trigger.srCodeEdd),i.push({srCode:t.srCode,isTrigger:t.value,parentSRSubmitRef:s.submitSRRef.toString()})}),s.triggerInfo=n),a.completeForm(t),!i.length){var d=a.selectItem.find("[data-sr-code="+o+"]"),r=d.data("submit-ref");"Y"===d.data("fatca")&&o!==a.trigger.srCodeFatca&&i.push({srCode:a.trigger.srCodeFatca,isTrigger:!0,parentSRSubmitRef:r}),"Y"===d.data("crs")&&o!==a.trigger.srCodeCrs&&i.push({srCode:a.trigger.srCodeCrs,isTrigger:!0,parentSRSubmitRef:r}),"Y"===d.data("edd")&&o!==a.trigger.srCodeEdd&&i.push({srCode:a.trigger.srCodeEdd,isTrigger:!0,parentSubmitSRRef:r})}i.length&&a.triggerForm(i)};e(t).on("message",function(t){var i=t.originalEvent.data;switch(i.message){case"completeError":a.completeError(i);break;case"completeForm":i.ortherParams&&i.ortherParams.isPRCNationality?d({title:"WARNING",description:"Please submit proof of entry",decline:{id:"decline-delete-rider",title:"OK",class:"btn-primary",func:function(){n(i)}}}):n(i),e("[data-id=contextual]").addClass("hidden");break;case"saveAndQuit":a.saveAndQuit(i,function(){i.clickProceed&&a.loadForm(Site.clickProceed)}),e("[data-id=contextual]").addClass("hidden");break;case"saveAndQuitCKA":a.saveAndQuitCKA(i.formData,i.isCloseForm);break;case"removeCurrentSR":d({title:"WARNING",description:"There are no eligible policies for this service request.",decline:{id:"",title:"close",class:"btn-primary",func:function(){a.loadingPage.removeClass(a.options.hidden);var e=a.formRequest.find(".aemform").data("sr-code"),t=a.selectItem.find("[data-sr-code="+e+"]"),i=t.data("submit-ref");a.removeItem(t,i,e,function(){a.formRequest.find(".aemform").remove(),a.listRequest.removeClass("hidden"),s=!1,a.loadingPage.addClass(a.options.hidden)})}}});break;case"showLoading":if(a.handleFormLoading(i.isShowLoading),i.initForm){var o=a.dataForm,r=!1;!Object.keys(JSON.parse(a.witnessData)).length&&(r=!0),o.witnessData=a.witnessData,o.isEditWitness=r,a.formRequest.find("iframe")[0].contentWindow.postMessage(o,a.targetOrgin)}break;case"dataMapping":i.initForm&&(a.dataForm.witnessData=a.witnessData,a.formRequest.find("iframe")[0].contentWindow.postMessage(a.dataForm,a.targetOrgin));break;case"showPopup":d({title:i.title,description:i.content,decline:{id:"decline-show-popup",title:"OK",class:"btn-primary",func:function(){if(i.completeForm&&n(i),i.saveAndQuit&&(a.saveAndQuit(i),e("[data-id=contextual]").addClass("hidden")),i.messageResponse){var t={message:i.messageResponse};a.formRequest.find("iframe")[0].contentWindow.postMessage(t,a.targetOrgin)}}}});break;case"policyLoan":a.policyLoanAction(i.formData);break;case"scrollTop":e("html, body").animate({scrollTop:e("#aemFormFrame").offset().top-90},"fast")}})},setCurrentStep:function(e){var t=this;switch(e){case 2:t.loadStepTwo();break;case 3:t.loadStepThree();break;case 4:t.loadStepFour();break;case 5:t.loadStepFive();break;case 6:t.loadStepSix();break;default:!0!==t.step1.data("loadStep")&&(t.loadStepOne(),t.step1.data("loadStep",!0)),t.step1.removeClass(t.options.hidden)}},loadStepOne:function(){var t=this;t.loadListRequestStepOne(),t.step1.lastNumber=0,t.step1.dataObject={},t.inputSearch.off(o.keyup).on(o.keyup,this.onKeyUpSearchBar.bind(this)),t.inputSearch.off(o.keyup).on(o.keyup,function(e){e.preventDefault(),t.didKeySearch(e)}),t.selectSearch.off(o.change).on(o.change,function(a){a.preventDefault(),t.resetData(),t.inputSearch.val(""),t.filterItems(t.step1.dataObject.data,"",e(this).val())}),t.btnShowMoreStep1.off(o.click).on(o.click,function(e){e.preventDefault(),t.renderListRequest()}),t.addServices(),t.removeServices(),t.clickProceed()},loadStepTwo:function(){this.handleUpload(),this.removeUploadedFile(),this.renderAttachment()},loadStepThree:function(){this.loadDataStepThree()},loadStepFour:function(){this.LoadDataStepFour()},loadStepFive:function(){this.LoadDataStepFive()},loadStepSix:function(){this.LoadDataStepSix()},handleFormLoading:function(e){var t=this.step1,a=t.find("[data-id=loading-processing-bar]"),i=t.find("#aemFormFrame");e?(i.addClass("hidden"),a.hasClass("hidden")&&a.removeClass("hidden")):(!a.hasClass("hidden")&&a.addClass("hidden"),i.removeClass("hidden"))},loadPageServiceRequest:function(){var a=this,i=a.options,s={submitRef:a.element.data("submit-ref")};a.loadingPage.removeClass(i.hidden),Site.ajaxUtil(a.options.url,a.options.method,"json",JSON.stringify(s),function(s){a.dataPos=s.data,a.customerDetail=a.dataPos.customer,t.targetOrgin=t.location.origin;var n=a.template.customerInfo.replace("{{LabelPolicyId}}",a.customerInfo.data("policy-id-lbl")).replace("{{LabelPolicyOwner}}",a.customerInfo.data("policy-owner-lbl")).replace("{{LabelCustomer}}",a.customerInfo.data("customer-lbl")),o=t.Handlebars.compile(n)(a.dataPos);a.customerInfo.append(o),a.currentStep=a.dataPos.currentStep||1,"draft"!==a.dataPos.submitStatus.toLowerCase()&&(a.currentStep=6),a.editable=a.dataPos.editable,a.witnessData=a.dataPos.witnessData&&a.dataPos.witnessData.trim()?a.dataPos.witnessData:"{}",a.dataPos.posPolicyNumber&&(a.isPolicyId=!0,a.policyNum=a.dataPos.policyResponse,a.policyNum.sourceSystem=a.dataPos.sourceSystem),a.dataPos.stpSrRequests&&!t._.isEmpty(a.dataPos.stpSrRequests)&&(a.countSelectSR=a.dataPos.stpSrRequests.length,a.loadingPage.addClass(i.hidden),a.leftServiceRequest.removeClass(i.hidden),a.rightServiceRequest.removeClass(i.hidden),e.each(s.data.stpSrRequests,function(e,t){t.srCode===a.trigger.srCodeFatca&&(a.trigger.hasFatca=!0),t.srCode===a.trigger.srCodeCrs&&(a.trigger.hasCrs=!0),t.srCode===a.trigger.srCodeEdd&&(a.trigger.hasEdd=!0),t.parentSRSubmitRef&&(t.listparentSRSubmitRef=t.parentSRSubmitRef.split(","))}),a.renderItemSelect(s.data.stpSrRequests)),a.leftServiceRequest.removeClass(i.hidden),a.rightServiceRequest.removeClass(i.hidden),a.element.find(".date-update-step").text(a.getStringDateUpdate(s.data.lastUpdatedOn||"")),a.setCurrentStep(a.currentStep),a.showStep("next"),a.initButton(),a.currentStep>5&&a.resubmitForm(),a.disabledBtnGotoAndSaveDraft()},function(){var s=e("#async-script").data("404-path");a.loadingPage.addClass(i.hidden),"edit"!==e("#async-script").data("cq-mode")&&t.location.replace(s),a.loadingPage.addClass(i.hidden)})},saveAndQuitCKA:function(e,t){var a=this,i=a.options,n=a.formRequest.find(".aemform").data("sr-code"),o=a.selectItem.find("[data-sr-code="+n+"]"),d=o.data("submit-ref"),l=o.find(".title-text").text(),c={submitRef:a.posSubmitRef,srRequest:{submitSRRef:d,srCode:n,submitStatus:"draft",srDescription:l,ckaData:JSON.stringify(e)}};a.ckaData=JSON.stringify(e),a.handleFormLoading(!0),Site.ajaxUtil(a.options.draftUrl,a.options.method,"json",JSON.stringify(c),function(){a.changeStatusText(o,a.statusTitle.draft),a.changeIconStatus(o,a.statusTitle.draft),a.formRequest.find(".aemform").remove(),t?(s=!1,a.listRequest.removeClass(i.hidden),o.find("[data-id=status]").removeClass(i.hidden),o.find("[data-id=edit]").remove(),o.find("li.hidden").removeClass(i.hidden)):a.loadIframe(d,n,"Y",a.trigger.cka.dataUrl)},function(e,t){throw t&&0===t.status&&r(),a.handleFormLoading(!1),a.loadingPage.addClass(i.hidden),e})},saveAndQuit:function(e,t){var a=this,i=a.options,n=a.formRequest.find(".aemform").data("sr-code"),o=a.selectItem.find("[data-sr-code="+n+"]"),d=o.data("submit-ref"),l=o.find(".title-text").text(),c={submitRef:a.posSubmitRef,srRequest:{submitSRRef:d,srCode:n,submitStatus:"draft",srDescription:l,formData:JSON.stringify(e.formData),policyApplied:JSON.stringify(e.polNum)}};a.handleFormLoading(!0),Site.ajaxUtil(a.options.draftUrl,a.options.method,"json",JSON.stringify(c),function(){o.find("li.hidden").removeClass(i.hidden),a.changeStatusText(o,a.statusTitle.draft),a.changeIconStatus(o,a.statusTitle.draft),a.formRequest.find(".aemform").remove(),a.listRequest.removeClass(i.hidden),s=!1,o.find("[data-id=status]").removeClass(i.hidden),o.find("[data-id=edit]").remove(),a.disabledBtnGotoAndSaveDraft(),"function"==typeof t&&t()},function(e,t){throw t&&0===t.status&&r(),a.handleFormLoading(!1),a.loadingPage.addClass(i.hidden),e})},completeError:function(e){var t,a,i=this;t=this.formRequest.find(".aemform").data("sr-code"),a=i.selectItem.find("[data-sr-code="+t+"]").find(".title-text").text(),d({title:"NOTICE",description:"Your submission of ‘"+a.toUpperCase()+"’ form has not been completed",confirm:{id:"save-and-quit",title:"Save & Quit",class:"btn-secondary",func:function(){i.saveAndQuit(e)}},decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){}}})},completeForm:function(t){var a,i,n,o,r=this,l=r.options;a=r.formRequest.find(".aemform").data("sr-code"),i=r.selectItem.find("[data-sr-code="+a+"]"),n=i.data("submit-ref"),o=i.find(".title-text").text(),r.handleFormLoading(!0);var c={submitRef:r.posSubmitRef,srRequest:{submitSRRef:n,srCode:a,submitStatus:"completed",srDescription:o,formData:JSON.stringify(t.formData),policyApplied:JSON.stringify(t.polNum)}};t.triggerInfo&&(c.srRequest.EDDInd=t.triggerInfo.EDDInd,c.srRequest.CRSInd=t.triggerInfo.CRSInd,c.srRequest.FATCAInd=t.triggerInfo.FATCAInd),t.witnessData&&Object.keys(t.witnessData).length&&(r.witnessData=JSON.stringify(t.witnessData),c.witnessData=r.witnessData),t.ortherParams&&(c.srRequest=e.extend({},c.srRequest,t.ortherParams)),Site.ajaxUtil(r.options.draftUrl,r.options.method,"json",JSON.stringify(c),function(){if(r.formRequest.addClass(l.hidden),r.listRequest.removeClass(l.hidden),i.find("li.hidden").removeClass(l.hidden),s=!1,i.find("[data-id=status]").removeClass(l.hidden).siblings("[data-id=edit]").remove(),r.changeIconStatus(i,r.statusTitle.completed),r.changeStatusText(i,r.statusTitle.completed),r.formRequest.find(".aemform").remove(),r.disabledBtnGotoAndSaveDraft(),t.triggerInfo){var e=r.selectItem.find("[data-submit-ref="+n+"]");e.attr("data-edd",t.triggerInfo.EDDInd),e.attr("data-fatca",t.triggerInfo.FATCAInd),e.attr("data-crs",t.triggerInfo.CRSInd)}d({title:o,description:"‘"+o.toUpperCase()+"’ is ready to submit",decline:{id:"continue",title:"CONTINUE",class:"btn-primary",func:function(){}}})},function(){d({title:o,description:"‘"+o.toUpperCase()+"’ form has not been completed",decline:{id:"continue",title:"CONTINUE",class:"btn-primary",func:function(){r.handleFormLoading(!1)}}})})},saveAsDraft:function(){var e=this;e.btnSaveAsDraft.off(o.click).on(o.click,function(t){t.preventDefault(),e.saveAsDraftAction(function(){d({title:"MESSAGE",description:"Saved as Draft. Your draft will be saved for 30 days and remains editable for 30 days.",decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){}}})})})},cancelRequest:function(){var a=this;a.btnCancelRequest.off(o.click).on(o.click,function(){d({title:"warning",description:"Do you really want to cancel POS request and go back to dashboard?",confirm:{id:"cancel-pos",title:"Yes",class:"btn-primary",func:function(){Site.vars.winElem.unbind(o.beforeunload),a.saveAsDraftAction(function(){e(".modal-backdrop").remove(),setTimeout(function(){d({title:"warning",description:"Your whole submission is canceled",decline:{id:"confirm-cancel-btn",title:"Close",class:"btn-secondary",func:function(){t.location.href=a.options.urlRedirect}}})},350)})}},decline:{id:"decline-pos",title:"No",class:"btn-secondary",func:function(){}}})})},mapDataToForm:function(t){var a,i=this.step1;e.each(t,function(e,t){(a=i.find("[name="+e+"]")).is(":checkbox")?i.find("[name="+e+"][value="+t+"]").prop("checked",!0):a.val(t)})},disabledBtnGotoAndSaveDraft:function(){var a=this,i=a.options,n=a.leftServiceRequest,o=!1,d=n.find("[data-id=status]"),r=n.find(i.btnGoTo),l=a.selectItem.find("."+i.itemSelect).length;e.each(d,function(t,i){e(i).text()!==a.statusTitle.statusCompleted&&(o=!0)}),(t._.isEmpty(d)||s)&&(o=!0),o?r.attr("disabled",!0):r.attr("disabled")&&r.removeAttr("disabled"),l&&a.btnSaveAsDraft.removeAttr("disabled"),!l&&a.btnSaveAsDraft.attr("disabled",!0)},showStep:function(e){var t=this,a=t.options,i=t.rightServiceRequest;t.rightServiceRequest.find("[data-step]").addClass(a.hidden),t.rightServiceRequest.find("[data-step="+t.currentStep+"]").removeClass(a.hidden);var s=i.find("[data-status-desc-step="+t.currentStep+"]"),n=i.find("[data-status-step="+t.currentStep+"]");"next"===e?(t.currentStep>1&&t.selectItem.find(".action-list").addClass(a.hidden),n.prevAll().addClass(a.statuscompletedStep)):(n.removeClass(a.statuscompletedStep),n.nextAll().removeClass(a.statuscompletedStep),n.nextAll().removeClass(a.statusCurrentStep),t.currentStep>1&&n.removeClass(a.statuscompletedStep),1===t.currentStep&&t.selectItem.find(".action-list").removeClass(a.hidden)),i.find("[data-status-desc-step]").removeClass(a.tabActive),s.addClass(a.tabActive),n.addClass(a.statusCurrentStep),t.currentStep>5&&i.find("[data-status-step]").addClass(a.statuscompletedStep)},addServices:function(){var t=this,a=t.listRequest;a.off(o.click,"[data-id=submit-services]").on(o.click,"[data-id=submit-services]",function(i){if(i.preventDefault(),!0===t.isCreatingSR)return!1;var s=a.find('input[type="checkbox"]'),n=s.filter(function(){return!this.disabled&&this.checked}),o=s.filter(function(){return!(-1!==t.exceptList.indexOf(e(this).attr("id"))||!this.checked||this.disabled)}).length;if(!n.length)return!1;var r=e(".select-list .select-item").filter(function(){return-1===t.exceptList.indexOf(e(this).attr("id"))}).length;if(t.countSelectSR=r,o+r>t.maxSelect)return d({title:"ERROR",description:"Please do not choose more than 10 POS requests per submission. <br>(Not inclusive of special declarations CKA, FATCA, CRS, EDD)",decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){}}}),!1;var l=t.step1.dataObject.data;t.arrayServices=[];for(var c=0;c<l.length;c++)t.arrayServicesTemp.indexOf(l[c].srCode)>-1&&t.arrayServices.push({srCode:l[c].srCode,srDescription:l[c].srDescription,CRSInd:l[c].CRSInd,FATCAInd:l[c].FATCAInd,EDDInd:l[c].EDDInd});t.addServicesLoadData(t.arrayServices),t.disabledBtnGotoAndSaveDraft(),e("html, body").animate({scrollTop:0},"fast")})},addServicesLoadData:function(t){var a=this,i={submitRef:a.posSubmitRef,serviceRequest:t};a.isCreatingSR=!0,Site.ajaxUtil(a.options.urlAddListServices,a.options.method,"json",JSON.stringify(i),function(t){t.data&&(e.each(t.data,function(t,i){var s=i.srCode,n=e("#"+s);i.parentSRSubmitRef&&(i.listparentSRSubmitRef=i.parentSRSubmitRef.split(",")),e.each(a.step1.dataObject.data,function(e,t){t.srCode===i.srCode&&(t.statusCheck=!0,t.disabledStt=!0,i.CKAInd=t.CKAInd,i.srCode===a.trigger.srCodeFatca&&(a.trigger.hasFatca=!0),i.srCode===a.trigger.srCodeCrs&&(a.trigger.hasCrs=!0),i.srCode===a.trigger.srCodeEdd&&(a.trigger.hasEdd=!0))}),n.prop("disabled",!0),n.parents("li").first().addClass(a.options.disabledClass)}),a.arrayServicesTemp=[],a.renderItemSelect(t.data),a.isCreatingSR=!1,a.disabledBtnGotoAndSaveDraft())},function(e){throw a.isCreatingSR=!1,e})},triggerForm:function(t){var a=this,i=[],n=[];a.loadingPage.addClass("hidden"),t.length>0&&e.each(t,function(t,s){e.each(a.step1.dataObject.data,function(e,t){s.srCode===t.srCode&&(a.selectItem.find("[data-sr-code="+s.srCode+"]").length?n.push({srCode:t.srCode,isTrigger:s.isTrigger,srDescription:t.srDescription,CRSInd:t.CRSInd,FATCAInd:t.FATCAInd,EDDInd:t.EDDInd,parentSRSubmitRef:s.parentSRSubmitRef}):s.isTrigger&&i.push({srCode:t.srCode,srDescription:t.srDescription,CRSInd:t.CRSInd,FATCAInd:t.FATCAInd,EDDInd:t.EDDInd,parentSRSubmitRef:s.parentSRSubmitRef}))})}),i.length&&a.addServicesLoadData(i),n.length&&e.each(n,function(e,t){if(t.isTrigger)a.updateTriggerForm(t.srCode,t.parentSRSubmitRef,!1);else{var i=a.selectItem.find("[data-sr-code="+t.srCode+"]"),n=i.data("submit-ref"),o=a.formRequest.find(".aemform").data("sr-code"),d=(i.data("parent-submit")||"").split(",");1===d.length&&a.selectItem.find("[data-sr-code="+t.srCode+"]").is("[data-parent-sr-submit-ref-"+t.parentSRSubmitRef+"]")&&a.removeItem(i,n,t.srCode,function(){t.srCode===o&&a.formRequest.find(".aemform").remove()&&a.listRequest.removeClass("hidden")&&(s=!1)}),d.length>1&&a.updateTriggerForm(t.srCode,t.parentSRSubmitRef,!0)}})},updateTriggerForm:function(t,a,i){var s=this,n=s.selectItem.find("[data-sr-code="+t+"]"),o=n.data("submit-ref"),d=(n.attr("data-parent-submit")||"").split(","),r={submitRef:s.posSubmitRef,srRequest:{submitSRRef:o,submitStatus:"draft"}};e.each(d,function(e,t){if(t===a)return d.splice(e,1),!1}),!i&&d.push(a),r.srRequest.parentSRSubmitRef=d.join(),Site.ajaxUtil(s.options.draftUrl,s.options.method,"json",JSON.stringify(r),function(){e.each(d,function(e,t){n.attr("data-parent-sr-submit-ref-"+t,""),n.find('[data-id="status"]').text()===s.statusTitle.statusCompleted&&(s.changeStatusText(n,s.statusTitle.draft),s.changeIconStatus(n,s.statusTitle.draft))}),n.attr("data-parent-submit",r.srRequest.parentSRSubmitRef),s.disabledBtnGotoAndSaveDraft()},function(e){throw e})},removeServices:function(){var t,a,i,n,r,l=this,c=l.options,m=function(e,t,a){d({title:e,description:t,confirm:{id:"delete",title:"delete",class:"btn-primary",func:a},decline:{id:"cancel",title:"cancel",class:"btn-secondary",func:function(){}}})};l.leftServiceRequest.off(o.click,c.linkRemoveItem).on(o.click,c.linkRemoveItem,function(o){o.preventDefault();var c=e(this).parents("."+l.options.itemSelect),u=c.attr("data-parent-submit");if(t=c.data("sr-code"),a=l.formRequest.find(".aemform").data("sr-code"),i=c.data("submit-ref"),n=c.find("[data-id=status]").text(),r=c.find(".title-text").text(),u){var f=u.split(","),p=!1;if(e.each(f,function(e,t){l.selectItem.find("[data-submit-ref="+t+"]").length&&(p=!0)}),p)return d({title:"",description:"‘"+r.toUpperCase()+"’ form can't be deleted!",decline:{id:"close",title:"close",class:"btn-secondary",func:function(){}}}),!1}var h="‘"+r.toUpperCase()+"’ form has not been completed, are you sure you want to delete?";n.toLowerCase()===l.statusTitle.statusCompleted&&(h="‘"+r.toUpperCase()+"’ is ready to submit, are you sure you want to delete?"),n!==l.statusTitle.statusAdd?m(r,h,s?function(){l.removeItem(c,i,t,function(){t===a&&l.formRequest.find(".aemform").remove()&&l.listRequest.removeClass("hidden")&&(s=!1)})}:function(){l.removeItem(c,i,t)}):l.removeItem(c,i,t)})},removeItem:function(e,a,i,s){var n=this,d={submitRef:n.posSubmitRef,submitSRRef:a};Site.ajaxUtil(n.options.urlRemove,n.options.method,"json",JSON.stringify(d),function(){n.listRequest.find("input[id="+i+"]").removeAttr("disabled checked").parents("li").removeClass(n.options.disabledClass).removeClass(n.options.hidden),e.remove(),n.countSelectSR--,n.arrayServicesTemp.pop(i),n.checkServiceRequest([i],[!1]),i===n.trigger.srCodeFatca&&(n.trigger.hasFatca=!1),i===n.trigger.srCodeEdd&&(n.trigger.hasEdd=!1),i===n.trigger.srCodeCrs&&(n.trigger.hasCrs=!1),n.removeItemTrigger(a),"function"==typeof s&&s(),n.disabledBtnGotoAndSaveDraft()},function(e){throw n.disabledBtnGotoAndSaveDraft(),Site.vars.winElem.unbind(o.beforeunload),t.location.reload(),e})},removeItemTrigger:function(t){var a=this,i=a.formRequest.find(".aemform").data("sr-code"),n=a.selectItem.find("[data-parent-sr-submit-ref-"+t+"]"),o=[],d=[];if(!n.length)return!1;e.each(n,function(t,i){e(i).data("sr-code")===a.trigger.srCodeFatca||e(i).data("sr-code")===a.trigger.srCodeEdd||e(i).data("sr-code")===a.trigger.srCodeCrs?o.push(i):d.push(i)}),n=[],n=o.concat(d),e.each(n,function(n,o){var d=e(o).data("sr-code"),r=e(o).attr("data-parent-submit")||"";(r&&r.split(",")).length>1?a.updateTriggerForm(d,t,!0):(a.listRequest.find("input[id="+d+"]").removeAttr("disabled checked").parents("li").removeClass(a.options.disabledClass).removeClass(a.options.hidden),a.countSelectSR--,a.arrayServicesTemp.pop(d),a.checkServiceRequest([d],[!1]),a.removeItem(o,e(o).data("submit-ref"),d,function(){d===i&&a.formRequest.find(".aemform").remove()&&a.listRequest.removeClass("hidden")&&(s=!1)}))})},clickProceed:function(){var t,a=this,i=a.options;a.leftServiceRequest.off(o.click,a.options.linkProceedItem).on(o.click,a.options.linkProceedItem,function(n){if(n.preventDefault(),t=e(this),Site.clickProceed=t,s){var o=a.formRequest.find(".aemform").data("sr-code"),r=a.selectItem.find("[data-sr-code="+o+"]"),l=r.find("[data-id=status]").text(),c=r.find(".title-text").text();l!==a.statusTitle.statusCompleted?d({title:"NOTICE",description:"Your submission of ‘"+c.toUpperCase()+"’ form has not been completed",confirm:{id:"close",title:"Close",class:"btn-primary",func:function(){}},decline:{id:"save-and-quit",title:"Save & Quit",class:"btn-primary",func:function(){a.formRequest.find("iframe")[0].contentWindow.postMessage({message:"clickProceed"},a.targetOrgin)}}}):(s=!1,r.find("li.hidden").removeClass(i.hidden),r.find("[data-id=status]").removeClass(i.hidden),r.find("[data-id=edit]").remove(),a.changeIconStatus(r,l),a.loadForm(t))}else a.loadForm(t)})},loadForm:function(t){var a=this,i=a.options,s=t.parents("."+i.itemSelect),n={srCode:s.data("sr-code"),submitSRRef:s.data("submit-ref"),CKAInd:s.data("cka")};e.ajax({url:a.selectItem.data("url"),type:a.selectItem.data("method"),data:n,dataType:"json"}).done(function(e){a.trigger.cka.loadForm=!1,a.loadIframe(s.data("submit-ref"),s.data("sr-code"),s.data("cka"),e.data)})},loadIframe:function(t,a,i,n){var o,d=this,r=d.options,l=!1,c=n.url;n.cka&&!d.trigger.cka.loadForm&&(d.trigger.cka.dataUrl=n,c=n.cka.url),e.ajax({url:c,success:function(i){l&&(d.trigger.cka.loadForm=!1),s=!0,d.formRequest.children().remove();var c,m,u=e(i).find(".aemform").addClass("service-request-form");if(u.attr("data-sr-code",a),d.formRequest.html(u.parent().html()),d.handleFormLoading(!0),!l){var f=d.selectItem.find("[data-sr-code="+a+"]");f.find('[data-id="select-proceed"]').parent().addClass(r.hidden),f.find("[data-id=status]").addClass(r.hidden),f.find("[data-id=edit]").remove(),f.find("[data-id=status]").after('<p class="bt4 p2" data-id="edit">'+d.statusTitle.inProgress+"</p>"),f.find("[data-id=status]").text()===d.statusTitle.statusAdd&&d.changeStatusText(f,d.statusTitle.draft),d.changeIconStatus(f,"")}c={submitRef:d.posSubmitRef,submitSrRef:t},m=function(a,i){if(o={message:"mapping",response:a,customerInfo:{userType:Site.getSessionInfo().userType}},d.isPolicyId&&(o.isPolicyId=d.isPolicyId),d.isPolicyId&&(o.policyNum=d.policyNum),d.witnessData&&(o.witnessData=d.witnessData),o.customerInfo=e.extend({},o.customerInfo,d.dataPos.customer),d.dataForm=o,l=i,d.selectItem.find("[data-submit-ref="+t+"]").data("parent-submit")){var s=d.selectItem.find("[data-submit-ref="+t+"]").data("parent-submit").split(","),n=[];e.each(s,function(e,t){n.push(d.selectItem.find("[data-submit-ref="+t+"]").data("sr-code"))}),n.length&&(o.parentSRCode=n)}},d.trigger.cka.loadForm?(d.trigger.cka.response.data[0].ckaData=d.ckaData,m(d.trigger.cka.response,!0)):Site.ajaxUtil(d.selectItem.data("form-url"),d.options.method,"json",JSON.stringify(c),function(t){n.cka&&(d.trigger.cka.response=t,d.trigger.cka.loadForm=!0,"FSC"===Site.getSessionInfo().userType&&e("[data-id=contextual]").removeClass("hidden")),m(t,!1)},function(e){throw e}),d.listRequest.addClass(r.hidden),d.formRequest.removeClass(r.hidden),d.disabledBtnGotoAndSaveDraft()},error:function(e){throw e}})},changeStatus:function(e,t){switch(e.toLowerCase()){case"completed":t.iconRing="green100-ring",t.iconCenter="accept-nav-2nd",t.editText=this.statusTitle.editCompleted;break;case"draft":case"incomplete":t.iconRing="yellow50-ring",t.iconCenter="alert-2nd",t.editText=this.statusTitle.editIncomplete;break;default:t.iconRing="yellow50-ring",t.iconCenter="edit-2ndg",t.editText=this.statusTitle.editAdd}return t},changeIconStatus:function(e,t){var a={iconRing:"",iconCenter:"",editText:"",htmlIcon:'<div class="progress-ring"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{ICONRING}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{ICONRING}}"></use><image class="icon-fallback" alt="{{ICONRING}}" src="'+n+'icons/{{ICONRING}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div><div class="progress-glyph"><svg class="icon-m icon-64 hide-on-fallback" role="img" title="{{ICONCENTER}}"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#{{ICONCENTER}}"></use><image class="icon-fallback" alt="edit-2ndg" src="'+n+'icons/{{ICONCENTER}}.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></div>'};(a=this.changeStatus(t,a)).htmlIcon=a.htmlIcon.replace(/{{ICONCENTER}}/g,a.iconCenter).replace(/{{ICONRING}}/g,a.iconRing),e.find(".progress-thumbnail").empty().html(a.htmlIcon),e.find("[data-id=select-proceed] span").text(a.editText)},changeStatusText:function(e,t){var a="";switch(t){case"draft":a=this.statusTitle.statusIncomplete;break;case"completed":a=this.statusTitle.statusCompleted}e.find("[data-id=status]").text(a)},onKeyUpSearchBar:function(){return!1},didKeySearch:function(e){if(!/(38|40|27)/.test(e.which)){var t=this.inputSearch.val(),a=this.selectSearch.val();this.resetData(),this.filterItems(this.step1.dataObject.data,t,a)}},loadListRequestStepOne:function(){var a=this,i=a.options,s={submitRef:a.element.data("submit-ref")};a.isPolicyId&&(s.polNum=a.policyNum.polNum,s.sourceSystem=a.policyNum.sourceSystem),a.loadingPage.removeClass(i.hidden),Site.ajaxUtil(a.options.urlServiceRequest,a.options.method,"json",JSON.stringify(s),function(s){if(!t._.isEmpty(s.data)){a.step1.dataObject.data=s.data;var n=[];e.each(a.selectItem.find("."+i.itemSelect),function(t,a){n.push(e(a).data("sr-code"))}),e.each(a.step1.dataObject.data,function(t,i){if(-1!==e.inArray(i.srCode,n)){i.statusCheck=!0,i.disabledStt=!0;var s=a.selectItem.find("[data-sr-code="+i.srCode+"]");i.srCode!==a.trigger.srCodeFatca&&"Y"===i.FATCAInd&&s.attr("data-fatca","Y"),i.srCode!==a.trigger.srCodeCrs&&"Y"===i.CRSInd&&s.attr("data-crs","Y"),i.srCode!==a.trigger.srCodeEdd&&"Y"===i.EDDInd&&s.attr("data-edd","Y"),"Y"===i.CKAInd&&s.attr("data-cka",i.CKAInd)}});var o=a.step1.dataObject.data.filter(function(e){return parseInt(e.priority)<=10});a.step1.dataObject.arrayData=o.sort(function(e,t){return parseInt(e.priority)>parseInt(t.priority)?1:parseInt(e.priority)>parseInt(t.priority)?-1:0}),a.renderListRequest(),a.step1.find("[data-id=loading-processing-bar]").addClass(i.hidden),a.inputSearch.attr("disabled",!1)}a.loadingPage.addClass(i.hidden)},function(){a.loadingPage.addClass(i.hidden)})},filterItems:function(e,t,a){var i=/^[A-Za-z]/;switch(a){case"A-F":i=/^[A-Fa-f]/;break;case"G-L":i=/^[G-Lg-l]/;break;case"M-R":i=/^[M-Rm-r]/;break;case"S-X":i=/^[S-Xs-x]/;break;case"Y-Z":i=/^[Y-Zy-z]/}e=e.filter(function(e){return""===a?parseInt(e.priority)<=10:"authentication"===a?"Y"===e.remoteAuthInd:i.test(e.srDescription)}),e=""===a?e.sort(function(e,t){return parseInt(e.priority)>parseInt(t.priority)?1:parseInt(e.priority)>parseInt(t.priority)?-1:0}):e.sort(function(e,t){return e.srDescription>t.srDescription?1:t.srDescription>e.srDescription?-1:0}),this.step1.dataObject.arrayData=e.filter(function(e){return"Y"===e.srDisplayInd&&e.srDescription.toLowerCase().indexOf(t.toLowerCase())>-1});var s;s="authentication"===a||"frequent"===a?this.selectSearch.find(":selected").text()+" POS Requests":"POS Requests Name start with ["+this.selectSearch.find(":selected").text()+"]",this.checkServiceRequest(this.arrayServicesTemp),this.ListContainer.parent().find("p.bt4").text(s),this.renderListRequest()},renderListRequest:function(){var a,i=this,s=i.btnShowMoreStep1.data("number-show"),n=i.step1.lastNumber+s,d=[];e.each(i.step1.dataObject.arrayData,function(e,t){e>=i.step1.lastNumber&&e<n&&d.push(t)}),i.step1.lastNumber=n,i.btnShowMoreStep1.removeClass(i.options.hidden),i.step1.dataObject.arrayData.length<=i.step1.lastNumber&&i.btnShowMoreStep1.addClass(i.options.hidden),a=t.Handlebars.compile(i.template.itemListRequest)(d),i.ListContainer.append(a),i.ListContainer.off(o.change,".add-on-checkbox input").on(o.change,".add-on-checkbox input",function(){var t=e(this);if(t.is(":checked"))-1===i.arrayServicesTemp.indexOf(t.attr("id"))&&i.arrayServicesTemp.push(t.attr("id"));else{var a=i.arrayServicesTemp.indexOf(t.attr("id"));i.arrayServicesTemp.splice(a,1)}}),!this.step1.dataObject.arrayData.length&&this.ListContainer.find("[data-id=no-result-sr]").removeClass("hidden")},checkServiceRequest:function(t,a,i){var s=this;void 0===a&&(a=[]),e.each(this.step1.dataObject.data,function(e,n){var o=s.arrayServicesTemp.indexOf(n.srCode)>-1;if(t.indexOf(n.srCode.toString())>-1){var d=a[e]||o;return n.statusCheck=d,void(n.disabledStt=void 0!==i&&d)}})},resetData:function(){this.ListContainer.empty(),this.step1.dataObject.arrayData=this.step1.dataObject.data,this.step1.lastNumber=0},renderItemSelect:function(a){var i=this;e.each(a,function(e,t){t=i.changeStatus(t.submitStatus,t)});var s=t.Handlebars.compile(this.template.selectItem)(a);this.selectItem.append(s)},renderAttachment:function(){var e=this,a=e.step2.find("form"),i={submitRef:e.posSubmitRef};e.loadingPage.removeClass(e.options.hidden),Site.ajaxUtil(e.options.urlUpload,e.options.method,"json",JSON.stringify(i),function(i){var s=t.Handlebars.compile(e.template.attachment),n=i.data.filter(function(e){return"others"!==e.name.toLowerCase()}),o=i.data.filter(function(e){return"others"===e.name.toLowerCase()});!n.length&&a.find("[data-id=required-title]").addClass("hidden"),!o.length&&a.find("[data-id=optional-title]").addClass("hidden"),a.find("[data-id=list-attachments]").html(s(n)),a.find("[data-id=list-optionals]").html(s(o)),e.handleValidate(),e.loadingPage.addClass(e.options.hidden)},function(t){throw e.loadingPage.addClass(e.options.hidden),t})},handleUpload:function(){var a,i,s,n,r=this,l=r.step2.find("form"),c=r.options,m=function(e){var t=document.createElement("canvas");e.width>=700?e.width>e.height?(t.width=700,t.height=e.height/e.width*t.width):(t.height=700,t.width=e.width/e.height*t.height):(t.width=e.width,t.height=e.height);var a=t.getContext("2d");a.drawImage(e,0,0,t.width,t.height);for(var i,s=a.getImageData(0,0,t.width,t.height),n=a.createImageData(t.width,t.height),o=s.data,d=n.data,r=o.length,l=0;l<r;l+=4)i=.2126*o[l]+.7152*o[l+1]+.0722*o[l+2],d[l]=d[l+1]=d[l+2]=i,d[l+3]=o[l+3];return a.putImageData(n,0,0),function(e){for(var t=atob(e.split(",")[1]),a=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),s=new Uint8Array(i),n=0;n<t.length;n++)s[n]=t.charCodeAt(n);return new Blob([i],{type:a})}(t.toDataURL("image/jpeg",.7))};l.off(o.change).on(o.change,'input[type="file"]',function(){if(i=e(this).parents(".uploaded-files").parents("li").data("submit-sr-ref"),s=e(this).parents(".uploaded-files").parents("li").data("attachment-id"),this.files.length)if(this.files[0].size>=c.fileSize)Site.vars.bodyElem.find("#large-size-modal").modal("show"),e(this).parents("li").first().remove();else if(e.inArray(this.files[0].type,c.fileTypeAllows)<0)Site.vars.bodyElem.find("#wrong-type-modal").modal("show"),e(this).parents("li").first().remove();else{var o=new FileReader,u=this,f={Authorization:Site.getCookie("jwtToken")?"Bearer "+Site.getCookie("jwtToken"):"",JSESSIONID:Site.getCookie("jbSessionId")||"",sessionInfo:Site.getCookie("sessionInfo")||""};o.readAsArrayBuffer(this.files[0]),o.onload=function(o){n=new FormData,a={submitRef:r.posSubmitRef,submitSRRefs:i.split(","),intFormAttachmentTypeId:s,fileType:"Attachment",isPDFSigned:!1};var p=function(a){var i=e(u).parents("ul").first().siblings("[data-id=processing-upload]"),s=e(u).parents("ul").first().siblings("[data-id=uploaded-list]");i.removeClass("hidden"),e.ajax({url:l.data("upload-api"),type:l.attr("method"),data:a,cache:!1,contentType:!1,processData:!1,headers:f,success:function(a){var n,o,l;a.statusCode&&200===a.statusCode?(i.addClass("hidden"),s.hasClass("hidden")&&s.removeClass("hidden"),e(u).parents("li").first().removeClass(c.resetClass).append((n=a.data.fileRef,o=t.endPointApi+a.data.url+"?j="+Site.getCookie("jbSessionId")+"&t="+Site.getCookie("jwtToken")+"&s="+Site.getCookie("sessionInfo"),l=a.data.name,'<a class="lk2" data-file-ref="'+n+'" data-id="uploaded-file" href="'+o+'" target="_blank">'+l+'</a><button class="remove-button" type="button" aria-label="Remove" data-id="remove-file"> <span aria-hidden="true">×</span></button>'))):(e(u).parents("li").first().remove(),i.addClass("hidden"),d({title:"ERROR",description:"Error while uploading the file. Please try again!!!",decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){}}})),r.handleValidate()},error:function(t){throw e(u).parents("li").first().remove(),i.addClass("hidden"),d({title:"ERROR",description:"Error while uploading the file. Please try again!!!",decline:{id:"close",title:"Close",class:"btn-secondary",func:function(){}}}),t}})};if(n.append("fileInfo",JSON.stringify(a)),/image/i.test(u.files[0].type)){t.URL=t.URL||t.webkitURL;var h=new Blob([o.target.result]),g=t.URL.createObjectURL(h),v=new Image;v.src=g,v.onload=function(){var e=m(v);n.append("fileAttachment",e,u.files[0].name),p(n)}}else n.append("fileAttachment",u.files[0]),p(n)}}}),l.off(o.click).on(o.click,"[data-id=upload-file], [data-id=take-picture]",function(t){t.preventDefault();var a=e(this).parents(".action-list").parents("li").first(),i=a.data("id"),s=a.parents("ul").first().find("[data-id=uploaded-file]").length,n=document.createElement("li"),c="take-picture"===e(this).data("id")?'accept="image/*" capture="camera"':"";s>=l.data("maximum-file")?d({title:"error",description:"You have uploaded "+l.data("maximum-file")+" files",decline:{id:"close",title:"close",class:"btn-secondary",func:function(){}}}):(e(n).addClass(r.options.resetClass),e(n).append('<input type="file" '+c+'class="hidden" name="'+i+'[]"></input>'),a.find(".uploaded-files").append(n),e(n).find('input[type="file"]').trigger(o.click))})},removeUploadedFile:function(){var t,a,i,s=this,n=s.step2.find("form");n.find("[data-id=list-attachments], [data-id=list-optionals]").off(o.click).on(o.click,"[data-id=remove-file]",function(){t=e(this).parents("li").first().find("[data-id=uploaded-file]").data("file-ref"),i=e(this).parents("ul").first().siblings("[data-id=uploaded-list]");var o=this;Site.ajaxUtil(n.data("remove-file-api"),n.attr("method"),"json",JSON.stringify({fileRef:t}),function(t){200===t.statusCode&&(a=e(o).parents("ul").first().find("[data-id=uploaded-file]").length-1,e(o).parents("li").first().remove(),!a&&i.addClass("hidden"),s.handleValidate())},function(e){throw e})})},handleValidate:function(){var t=this.step2.find("form").find("[data-id=list-attachments] [data-id=attachments]"),a=e("[data-id=go-to-declaration]"),i=[],s=!1;e.each(t,function(t,a){var s={index:t,total:e(a).find("[data-id=uploaded-file]").length};i.push(s)}),e.each(i,function(a,i){var n=e(t[i.index]).find("[data-id=validate-upload]");i.total?!n.hasClass("hidden")&&n.addClass("hidden"):(n.removeClass("hidden"),s=!0)}),s?a.attr("disabled",!0):a.attr("disabled")&&a.removeAttr("disabled")},loadDataStepThree:function(){var e=this,t=e.step3,a=e.options,i={submitRef:e.posSubmitRef},s=t.find("[data-id=service-error]"),n=t.find("[data-id=no-result]");e.loadingPage.removeClass(a.hidden),Site.ajaxUtil(e.options.urlDeclaration,e.options.method,"json",JSON.stringify(i),function(t){t.data?e.renderHTMLStepThree(t.data):n.removeClass("hidden"),e.loadingPage.addClass(a.hidden)},function(t){throw e.loadingPage.addClass(a.hidden),s.removeClass("hidden"),t})},renderHTMLStepThree:function(a){var i=t.Handlebars.compile(this.template.wapperStepThree)(a);this.step3.find("#declaration").html("").append(i),this.loading.addClass(this.options.hidden),e(this.options.btnReview).removeAttr("disabled")},LoadDataStepFour:function(){var e=this.step4,a=Site.getCookie("jbSessionId")||"",i=Site.getCookie("jwtToken")||"",s=Site.getCookie("sessionInfo")||"",n=t.endPointApi+"/posRequest/review/"+this.posSubmitRef+"?j="+a+"&t="+i+"&s="+s+"#toolbar=0";e.find(".data-content").attr("data-pdf-path",n),e.find(".data-content")["view-pdf"]("init"),e.find(".data-content").find(".review-iframe").remove(),this.loadingPage.addClass(this.options.hidden)},LoadDataStepFive:function(){var a,i,s=this,n=s.options,r={submitRef:s.posSubmitRef};s.loadingPage.removeClass(n.hidden),Site.ajaxUtil(n.urlMethod,n.method,"json",JSON.stringify(r),function(r){r.data&&(r.data.directAuth&&(a=(a=t.Handlebars.compile(s.template.methodStepFiveTitle)("directAuth")).concat(t.Handlebars.compile(s.template.methodStepFiveAuth)(r.data.directAuth))),r.data.remoteAuth&&r.data.remoteAuth.length&&(i=(i=t.Handlebars.compile(s.template.methodStepFiveTitle)("remoteAuth")).concat(t.Handlebars.compile(s.template.methodStepFiveAuth)(r.data.remoteAuth))),s.step5.find("[data-id=select-method]").children().remove(),s.step5.find("[data-id=select-method]").append(a,i),s.loadingPage.addClass(n.hidden),"success"===Site.getParamItemUrl("signatureResult")?(s.paramsSubmit.authorizationType=s.authorType.signature,s.responseSignature()):s.loadingPage.addClass(n.hidden),s.closeModal.off(o.click).on(o.click,function(){var t=e(this);t.parents(".modal").modal("hide"),t.data("verified")&&s.submitionFinal(s.paramsSubmit)}),s.step5.find("[data-type]").off(o.click).on(o.click,function(){var t,a={};switch(e(this).data("type")){case"signature":s.callKofax();break;case"aiaOTP":var i=s.modalaiaOTP.find("[data-id=verify-otp]");i.parsley().reset(),i.data("submit-ref",s.posSubmitRef),i.data("verify-otp",e("[data-verify-otp]").data("verify-otp")),i.data("verified-modal",s.modalSMSVerified.get(0)),i["sms-handle"]({aiaOtpType:!0,method:s.options.method,customerId:s.customerDetail.idNum,userId:Site.getSessionInfo().userId||"",numberVerifyOtp:parseInt(s.options.numberVerifyOtp),verifiedModal:s.modalaiaOTP,generateCallback:function(){s.modalaiaOTP.find("form").parsley().reset(),s.modalaiaOTP.modal("show")},verifyCallback:function(e){s.modalaiaOTP.modal("hide"),s.modalSMSVerified.modal("show"),s.otpInfo=e}}),i["sms-handle"]("handleGenerateOTP"),s.modalSMSVerified.off("hidden.bs.modal").on("hidden.bs.modal",function(){var e={authorizationType:s.authorType.aia2fa,otpToken:i.data("otp-token")||"",otpInfo:s.otpInfo};s.paramsSubmit=e,s.submitionFinal(e)});break;case"oneKey":s.loadingPage.removeClass("hidden");var r=s.customerDetail.idNum||"",l=function(t,a){s.isTokenLinked=!1;var i=s.hardwareOnekeyLink.find("form"),r=s.smsOnekeyLink.find("form");s.modalOnkey.find("[data-hardware-link-btn]").off(o.click).on(o.click,function(){s.isTokenLinked=!0,s.modalOnkey.modal("hide"),s.modalOnkeyAgreeLinkDevice.modal("show")}),s.modalOnkey.find("[data-onekey-sms-link-btn]").off(o.click).on(o.click,function(){s.modalOnkey.modal("hide"),s.modalOnkeyAgreeLinkDevice.modal("show")}),s.modalOnkeyAgreeLinkDevice.find("button.btn-secondary").off(o.click).on(o.click,function(){s.isTokenLinked?(s.hardwareOnekeyLink.find("form").parsley().reset(),s.hardwareOnekeyLink.find("input").val(""),s.hardwareOnekeyLink.modal("show"),i.data("verify-otp",n.onekeyVerifyTokenLink),i.data("verified-modal",s.modalSMSVerified.get(0)),i["sms-handle"]({method:s.options.method,onekeyHardwareLinkType:!0,customerId:s.customerDetail.idNum,deviceId:t.deviceId,serialNum:t.deviceId,vendorId:t.vendorId,verifyCallback:function(){s.hardwareOnekeyLink.modal("hide"),d({title:"ONEKEY ASSURITY 2FA",description:"LINK TOKEN SUCCESS.",decline:{id:"",title:"OK",class:"btn-primary",func:function(){}}})},verifyCallbackUnLinked:function(t){s.hardwareOnekeyLink.modal("hide"),d({title:"Warning",description:t.message||"Invalid Device ID.",decline:{id:"",title:"Close",class:"btn-primary",func:function(){e('[data-type="oneKey"]').length&&e('[data-type="oneKey"]').click()}}})}}),i["sms-handle"]("handleGenerateOTP")):(s.smsOnekeyLink.find("form").parsley().reset(),s.smsOnekeyLink.find("input").val(""),s.smsOnekeyLink.modal("show"),r.data("verify-otp",n.onekeySmsVerifyLink),r.data("verified-modal",s.modalOnkeyVerified.get(0)),r["sms-handle"]({method:s.options.method,onekeySMSLinkType:!0,numberVerifyOtp:parseInt(s.options.numberVerifyOtp),customerId:s.customerDetail.idNum,deviceId:a.deviceId,serialNum:a.deviceId,vendorId:a.vendorId,link:!0,verifiedModal:s.smsOnekeyLink,generateCallback:function(){s.smsOnekeyLink.find("form").parsley().reset(),s.smsOnekeyLink.modal("show")},verifyCallback:function(){s.smsOnekeyLink.modal("hide"),d({title:"ONEKEY ASSURITY 2FA",description:"LINK MOBILE SUCCESS.",decline:{id:"",title:"Close",class:"btn-primary",func:function(){}}})},verifyCallbackUnLinked:function(t){s.smsOnekeyLink.modal("hide"),d({title:"Warning",description:t.message||"Invalid Device ID.",decline:{id:"",title:"Close",class:"btn-primary",func:function(){e('[data-type="oneKey"]').length&&e('[data-type="oneKey"]').click()}}})}}),r["sms-handle"]("handleGenerateOTP"))})};r&&(t=function(){var t={},i={};Site.ajaxUtil(n.assignedTokenApi,s.options.method||"POST","json",JSON.stringify({customerId:r}),function(r){200!==r.statusCode&&(l(a.hardwareInfo,a.smsInfo),s.modalOnkey.find(".has-link-device").addClass("hidden").siblings(".not-link-device").removeClass("hidden"),s.loadingPage.addClass("hidden"),s.modalOnkey.modal("show"));for(var c,m,u,f,p,h=r.data,g=0;g<h.length;g++)"hardwareotpdevice"===h[g].model.toLowerCase()?(t.serialNum=h[g].serialNum,t.deviceId=h[g].deviceId,t.vendorId=h[g].vendorId,s.modalOnkey.find(".has-link-device [data-device-type="+h[g].model.toLowerCase()+"]").removeClass("hidden"),s.modalOnkey.find(".not-link-device [data-device-type="+h[g].model.toLowerCase()+"]").addClass("hidden")):"smsotp"===h[g].model.toLowerCase()&&(i.serialNum=h[g].serialNum,i.deviceId=h[g].deviceId,i.vendorId=h[g].vendorId,s.modalOnkey.find(".has-link-device [data-device-type="+h[g].model.toLowerCase()+"]").removeClass("hidden"),s.modalOnkey.find(".not-link-device [data-device-type="+h[g].model.toLowerCase()+"]").addClass("hidden"));c=t,m=i,u=e("body").find("#addon-modal-onekey-pin").find("form"),f=s.smsOnekey.find("form"),p=!1,e("[data-hardware-btn]").off("click").on("click",function(){s.modalOnkey.modal("hide"),s.hardwareOnekey.find("form").parsley().reset(),s.hardwareOnekey.modal("show"),u.data("verify-otp",e("[data-verify-token-otp]").data("verify-token-otp")),u.data("verified-modal",s.modalSMSVerified.get(0)),s.loadingPage.addClass("hidden"),u["sms-handle"]({method:s.options.method,onekeyHardwareType:!0,customerId:s.customerDetail.idNum,deviceId:c.deviceId,serialNum:c.serialNum,vendorId:c.vendorId,verifyCallback:function(e){s.hardwareOnekey.modal("hide"),s.modalOnkeyVerified.modal("show"),p=!0,s.otpInfo=e},callBackGetLinked:function(t){s.hardwareOnekey.modal("hide"),d({title:"ONEKEY ASSURITY 2FA",description:t+='<div class="text-left label-heavy padding-top-s">If you wish to link another registered device, please click <a class="underline s5" href="#" data-id="popup-linked-device">here</a>.<br>[Please note that you are only able to link your registered device. For new device registration, please go to the &#8220;<a class="s5 underline" target="_blank" title="Assurity Official Website" href="https://portal.assurity.sg/naf-web/public/index.do">Assurity Official Website</a>&#8221;]</div>',decline:{id:"",title:"Close",class:"btn-secondary",func:function(){}}}),e('[data-id="common-popup"]').off(o.click,'[data-id="popup-linked-device"]').on(o.click,'[data-id="popup-linked-device"]',function(t){t.preventDefault(),e('[data-id="common-popup"]').modal("hide"),s.isTokenLinked=!0,s.modalOnkeyAgreeLinkDevice.find("button").click()})}}),u["sms-handle"]("handleGenerateOTP")}),e("[data-onekey-sms-btn]").off(o.click).on(o.click,function(){f.data("verify-otp",n.onekeySmsVerify),f.data("verified-modal",s.modalOnkeyVerified.get(0)),f["sms-handle"]({method:s.options.method,onekeySMSType:!0,numberVerifyOtp:parseInt(s.options.numberVerifyOtp),customerId:s.customerDetail.idNum,deviceId:m.deviceId,serialNum:m.serialNum,vendorId:m.vendorId,link:!1,generateCallback:function(){s.modalOnkey.modal("hide"),s.smsOnekey.find("form").parsley().reset(),s.smsOnekey.modal("show")},verifyCallback:function(e){s.smsOnekey.modal("hide"),s.modalOnkeyVerified.modal("show"),s.otpInfo=e},callBackGetLinked:function(t){s.smsOnekey.is(".in")&&s.smsOnekey.modal("hide"),s.modalOnkey.is(".in")&&s.modalOnkey.modal("hide"),d({title:"ONEKEY ASSURITY 2FA",description:t+='<div class="text-left label-heavy padding-top-s">If you wish to link another registered device, please click <a class="underline s5" href="#" data-id="popup-linked-device">here</a>.<br>[Please note that you are only able to link your registered device. For new device registration, please go to the &#8220;<a class="s5 underline" target="_blank" title="Assurity Official Website" href="https://portal.assurity.sg/naf-web/public/index.do">Assurity Official Website</a>&#8221;]</div>',decline:{id:"",title:"Close",class:"btn-secondary",func:function(){}}}),e('[data-id="common-popup"]').off(o.click,'[data-id="popup-linked-device"]').on(o.click,'[data-id="popup-linked-device"]',function(t){t.preventDefault(),s.isTokenLinked=!1,e('[data-id="common-popup"]').modal("hide"),s.modalOnkeyAgreeLinkDevice.find("button").click()})}}),f["sms-handle"]("handleGenerateOTP")}),s.modalOnkey.find('[data-id="linked-device"]').off(o.click).on(o.click,function(t){t.preventDefault(),e(this).parents(".has-link-device").addClass("hidden").siblings(".not-link-device").removeClass("hidden")}),s.modalOnkeyVerified.off("hidden.bs.modal").on("hidden.bs.modal",function(){var e={authorizationType:p?s.authorType.onekeyToken:s.authorType.onekeySMS,otpToken:s.modalOnkeyVerified.data("otp-token")||"",otpInfo:s.otpInfo};s.loadingPage.removeClass("hidden"),s.paramsSubmit=e,s.submitionFinal(e)}),l(a.hardwareInfo,a.smsInfo),s.modalOnkey.find(".has-link-device-text").addClass("hidden"),s.modalOnkey.find(".has-link-device").removeClass("hidden").siblings(".not-link-device").addClass("hidden"),1===h.length&&!s.modalOnkey.find(".has-link-device").is("hidden")&&s.modalOnkey.find(".has-link-device-text").removeClass("hidden"),s.loadingPage.addClass("hidden"),s.modalOnkey.modal("show")},function(e){throw l(a.hardwareInfo,a.smsInfo),s.modalOnkey.find(".has-link-device").addClass("hidden").siblings(".not-link-device").removeClass("hidden"),s.loadingPage.addClass("hidden"),s.modalOnkey.modal("show"),e})},Site.ajaxUtil(n.onekeyQueryActDevice,n.method,"json",JSON.stringify({customerId:r}),function(e){if(200!==e.statusCode)return s.loadingPage.addClass("hidden"),s.modalOnkeyNoActDevice.modal("show"),!1;a.hardwareInfo={},a.smsInfo={};for(var i=0;i<e.data.length;i++)"hardwareotpdevice"===e.data[i].deviceGroup.toLowerCase()?(a.hardwareInfo.serialNum=e.data[i].deviceId,a.hardwareInfo.deviceId=e.data[i].deviceId):"smsotp"===e.data[i].deviceGroup.toLowerCase()&&(a.smsInfo.serialNum=e.data[i].deviceId,a.smsInfo.deviceId=e.data[i].deviceId);"function"==typeof t&&t(e.data)},function(e){throw s.loadingPage.addClass("hidden"),s.modalOnkeyNoActDevice.modal("show"),e},n.headerParams));break;default:var c=s.modalRemote.find("[data-id=verify-remote]");c.parsley().reset(),s.dataPos.customer&&(s.dataPos.customer.phone&&e.each(s.dataPos.customer.phone,function(e,t){"mobile"===t.phoneType&&t.phoneNo&&(t.phoneNo=t.phoneNo.replace("-","").replace("+","").trim(),c.find("[data-remote-sms]").val(t.phoneNo))}),s.dataPos.customer.email&&c.find("[data-remote-email]").val(s.dataPos.customer.email[0].emailAddress)),s.modalRemote.modal("show"),c.data("binding-authen-form")||s.bindingRemoteAuthPopupForm(c)}}))},function(){s.loadingPage.addClass(n.hidden)})},bindingRemoteAuthPopupForm:function(a){var i=this,s=i.options,n=!1,d=a.find("[data-id=send-remote]");a.data("binding-authen-form",!0),a.find("[type=checkbox]").off(o.change).on(o.change,function(){var e=a.find("[type=checkbox]:checked").length;e&&d.attr("disabled",!1),!e&&d.attr("disabled",!0)}),a.off("submit").on("submit",function(r){return r.preventDefault(),!n&&(e(this).parsley().validate(),!!a.parsley().isValid()&&(n=!0,d.prop("disabled",!0),void Site.ajaxUtil(s.sendRemote,s.method,"json",JSON.stringify({customerId:i.customerDetail.idNum,userId:Site.getSessionInfo().userId,agentName:void 0===Site.getSessionInfo().agent||null===Site.getSessionInfo().agent?"":Site.getSessionInfo().agent.agentName,submitRef:i.posSubmitRef,phoneNumber:a.find("[data-remote-sms]").val(),isCheckedRemoteSms:a.find("#remoteAuthSMS").prop("checked"),emailAddress:a.find("[data-remote-email]").val(),isCheckedRemoteEmail:a.find("#remoteAuthEmail").prop("checked")}),function(e){200===e.statusCode&&(i.modalRemote.modal("hide"),i.modalRemoteComplete.modal("show"),i.modalRemoteComplete.off("hidden.bs.modal").on("hidden.bs.modal",function(){Site.vars.winElem.unbind(o.beforeunload),t.location.reload()})),n=!1,d.prop("disabled",!1)},function(t){throw i.modalRemote.modal("hide"),e("#addon-modal-remote-send-error").modal("show"),n=!1,d.prop("disabled",!1),t})))})},callKofax:function(){var a,i=this,s=i.options,n={aemUrl:t.location.href};i.loadingPage.removeClass(s.hidden),Site.ajaxUtil(i.options.urlSignature,i.options.method,"json",JSON.stringify(n),function(t){if(t.data.formData){a=e('<form class="hidden form-sign" action="'+t.data.url+'" method="'+i.options.method+'"></form>'),e.each(t.data.formData,function(e,t){a.append('<input type="hidden" name="'+e+'" value="'+t+'"/>')});var n=Site.getCookie("jwtToken")?"Bearer "+Site.getCookie("jwtToken"):"",d=Site.getCookie("jbSessionId")||"",r=Site.getCookie("sessionInfo")||"";a.append('<input type="hidden" name="Authorization" value="'+n+'"/>'),a.append('<input type="hidden" name="JSESSIONID" value="'+d+'"/>'),a.append('<input type="hidden" name="sessionInfo" value="'+r+'"/>'),i.step5.append(a),Site.vars.winElem.unbind(o.beforeunload),i.step5.find(".form-sign").submit()}i.loadingPage.addClass(s.hidden)},function(){i.loadingPage.addClass(s.hidden)})},responseSignature:function(){var e=this,a=e.options,i={submitRef:e.posSubmitRef};e.loadingPage.removeClass(a.hidden),t.history.replaceState(null,null,Site.deleteParamUrl("signatureResult")),Site.ajaxUtil(e.options.urlResponseSignature,e.options.method,"json",JSON.stringify(i),function(t){"verified"===t.data.message&&e.modalSignatureVerified.modal("show")},function(){e.loadingPage.addClass(a.hidden)})},submitionFinal:function(a){var i=this,s=i.options,n={submitRef:void 0!==a.posSubmitRef?a.posSubmitRef:i.posSubmitRef,reqType:void 0!==a.reqType?a.reqType:"submit",authorizationType:a.authorizationType||"",otpToken:a.otpToken||"",customerName:void 0!==a.reqType?a.reqType:i.dataPos.customer.fullNm,otpInfo:a.otpInfo},r=function(a){var s="";Array.isArray(a.data)?e.each(a.data,function(e,t){s+=t.errorMessage+"<br>"}):a.data&&(s=a.data.errorMessage),d({title:"Warning",description:"The submission failed, please submit again<br>"+s,decline:{id:"close",title:"close",class:"btn-secondary",func:function(){i.currentStep=1,i.saveAsDraftAction(function(){Site.vars.winElem.unbind(o.beforeunload),t.location.reload()})}}})};i.loadingPage.removeClass(s.hidden),i.submitionStatus=!0,Site.ajaxUtil(i.options.urlLastStep,i.options.method,"json",JSON.stringify(n),function(e){if(i.loadingPage.addClass(s.hidden),200!==e.statusCode)return r(e),!1;Site.vars.winElem.unbind(o.beforeunload),t.location.reload()},function(e,t){if(t&&0===t.status)return i.loadingPage.addClass(s.hidden),d({title:"Warning",description:"Please try to Submit again.",decline:{id:"close",title:"close",class:"btn-secondary",func:function(){return!1}}}),!1;throw i.loadingPage.addClass(s.hidden),r(e),e})},getStringDateUpdate:function(e){if(""!==e){var t=new Date(e),a=t.getHours(),i=t.getHours()>=12?"pm":"am",s=t.getMinutes();return a=a<10?"0"+a:a,s=s<10?"0"+s:s,"Updated "+t.getDate().toString()+" "+["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]+", "+a+":"+s+" "+i}},LoadDataStepSix:function(){var a=this,i=a.step6,s=a.options;if(!t._.isEmpty(a.dataPos)){var d,r,l=a.dataPos,c=l.submitStatus||"",m="";switch(c.toLowerCase()){case"draft":c="Saved",m="Saved",d="yellow100-ring",r="open-2nd";break;case"pending":m="Pending Authorization",c="Submitted",d="yellow100-ring",r="accept-nav-2nd";break;case"expired":c="Expired",m="Expired",d="grey0-ring",r="closedark-glyph";break;case"rejected":c="Rejected",m="Rejected by Customer",d="red100-ring",r="closedark-glyph";break;default:c="Submitted",m="Submitted for Processing",d="green100-ring",r="accept-nav-2nd",e("[data-last-submit]").prev().removeClass("hidden")}a.rightServiceRequest.find("[data-status-desc-step="+a.currentStep+"] p").text(m);var u=new Date(parseInt(l.lastUpdatedOn)),f=u.getHours()>=12?" PM":" AM",p=1===u.getHours().toString().length?"0"+u.getHours().toString():u.getHours().toString(),h=1===u.getMinutes().toString().length?"0"+u.getMinutes().toString():u.getMinutes().toString();l.iconRing=d,l.iconCenter=r,l.titleStatus=c,l.lastUpdatedOnSubmit=Site.getFormatDate(l.lastUpdatedOn)+" "+p+":"+h+" "+f;var g=t.Handlebars.compile(a.template.templateLastStep)(l),v=a.step6.find("[data-title-step6]");v.length?v.html(g):i.find(".completed-pos").before(g);var b=i.find("[data-id=no-result]");if(!l.masterPDFSignedUrl&&b.removeClass("hidden"),l.preloadSignedPdfUrl){a.step6.find(".preload-signed-pdf").remove();var k=e('<iframe class="hidden preload-signed-pdf" src="'+l.preloadSignedPdfUrl+'"></iframe>');i.append(k),k.on("load",function(){l.masterPDFSignedUrl&&i.find("[data-id=master-pdf]").html('<div class="review-iframe" style="overflow:auto;-webkit-overflow-scrolling:touch;width:100%;"><iframe id="iframe-review" src="'+l.masterPDFSignedUrl+'#toolbar=0" width="794" scrolling="yes" frameborder="0" height="600" /> </div>')})}else{l.masterPDFSignedUrl&&i.find("[data-id=master-pdf]").attr("data-pdf-path",l.masterPDFSignedUrl).addClass("pdf-view bg-b8"),i.find("[data-id=master-pdf]")["view-pdf"]("init");var y=new URL(l.masterPDFSignedUrl.replace("/signature/tmpPdf","/signature/tmpPdf/download")),S='<a target="_blank" class="icons-list margin-bottom-xs" href="'+y.origin+"/"+y.pathname+"?j="+y.search.split("j=")[1]+'"><img class="icon-s icon-24" src="'+n+'icons/downloadsearchaltb-2ndg.png" /><span class="lk1">Download pdf</span></a><br />';i.find("[data-id=master-pdf]").before(S)}var w=a.modalRemote.find("[data-id=verify-remote]");w.data("binding-authen-form")||a.bindingRemoteAuthPopupForm(w),e("[data-resend-authorize-btn]").off(o.click).on(o.click,function(){a.loadingPage.removeClass(s.hidden);var e={customerId:a.customerDetail.idNum};Site.ajaxUtil(s.resendAuthorize,a.options.method,"json",JSON.stringify(e),function(e){""!==e.data.phoneNumber?(a.modalRemote.find("[data-remote-sms]").val(e.data.phoneNumber.replace("-","").replace("+","")),a.modalRemote.find("#remoteAuthSMS").prop("checked")):a.modalRemote.find("#remoteAuthSMS").prop("checked",!1),""!==e.data.email?(a.modalRemote.find("[data-remote-email]").val(e.data.email),a.modalRemote.find("#remoteAuthEmail").prop("checked")):a.modalRemote.find("#remoteAuthEmail").prop("checked",!1),a.loadingPage.addClass(s.hidden),a.modalRemote.modal("show")},function(e){throw e})}),e("[data-resend-email-btn]").off(o.click).on(o.click,function(){a.modalResendPdf.modal("show")});var C=a.modalResendPdf.find("form");C.off("submit").on("submit",function(t){if(t.preventDefault(),e(this).parsley().validate(),!C.parsley().isValid())return!1;Site.ajaxUtil(s.verifySendPdf,e(this).attr("method"),"json",JSON.stringify({submitRef:a.posSubmitRef,customerId:a.customerDetail.idNum,emailAddress:C.find("[data-remote-email]").val()}),function(t){a.modalResendPdf.modal("hide"),200===t.statusCode?a.modalSendPdfComplete.modal("show"):e("#addon-modal-remote-send-error").modal("show"),a.modalResendPdf.modal("hide")},function(t){throw a.modalResendPdf.modal("hide"),e("#addon-modal-remote-send-error").modal("show"),t})})}a.loading.addClass(s.hidden)},policyLoanAction:function(e){var t=this;switch(e.action){case"terrorist":d({title:e.title,description:"As we are unable to process your request, please visit http://www.aia.com.sg  to download and send the completed service request form to us...",decline:{id:"decline-policy-loan",title:"OK",class:"btn-primary",func:function(){Site.vars.winElem.unbind(o.beforeunload),location.reload()}}});break;case"sgd":d({title:e.title,description:"Instant Cheque option is not available",decline:{id:"decline-policy-loan",title:"OK",class:"btn-primary",func:function(){t.formRequest.find("iframe")[0].contentWindow.postMessage({message:"sgdOk"},t.targetOrgin)}}});break;case"softlocked":d({title:"Policy SOFTLOCKED",description:"Policy is soft locked. Please choose another payment method",decline:{id:"decline-policy-loan",title:"OK",class:"btn-primary",func:function(){}}})}},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var s=e.data(this,i);s?s[t]&&s[t](a):e.data(this,i,new l(this,t))})},e.fn[i].defaults={disabledClass:"disabled",hidden:"hidden",linkProceedItem:"[data-id=select-proceed]",linkRemoveItem:".select-remove",itemSelect:"select-item",btnPrevious:"[data-previous-step]",btnReview:"[data-id=review-pos-request]",btnGoTo:"[data-id=go-to-attachment]",statuscompletedStep:"completed-step",tabActive:"active",currentIndex:"[data-current-step]",statusCurrentStep:"current-step",fileSize:5242880,fileTypeAllows:["image/jpeg","image/gif","image/png"],resetClass:"reset-margin",loading:"[data-id=loading-processing-bar]"},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="dashboard-filter",s=Site.getSessionInfo()||{},n="FSC"===s.userType&&s.agent.agentClass>29,o=function(a){var i,s,n=(i=a,s=[],e.each(i,function(e){var t={};i[e].value&&(t[i[e].name]=i[e].value,s.push(t))}),s),o="";n&&e.each(n,function(t){o+="&"+e.param(n[t])}),t.history.pushState({},null,t.location.href.split(/[?#]/)[0]+o.replace("&","?"))},d=function(e,t){var a={name:e.find(".sort-by").attr("name"),value:e.find(".sort-by").val()};return t.push(a),t},r={click:"click."+i,change:"change."+i},l='<div class="result-table">{{#each .}}<div class="result-item padding-top-s padding-bottom-s card-vertical-separator-bottom"><div class="thumbnail result-item-cell">{{#ifEquals policyHolderGender "M"}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+Site.vars.assetPath+'icons/icons.svg#malepressed-prime1"></use><image class="icon-fallback" src="'+Site.vars.assetPath+'icons/malepressed-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{else}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+Site.vars.assetPath+'icons/icons.svg#femalepress-prime1"></use><image class="icon-fallback" src="'+Site.vars.assetPath+'icons/femalepress-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}<div class="agent"><h5 class="h5 title-text">{{policyHolderName}}</h5><p class="bt4 b6">{{#each serviceRequest}}{{#ifEquals @index 0}}{{description}} {{/ifEquals}}{{/each}}{{#ifNumCond 1 serviceRequest.length }} (+{{math serviceRequest.length "-" 1}}) {{/ifNumCond}}</p>{{#switch submitStatus}}{{#case "draft" break=true}}<p class="bt4 text-color text-capitalize">Draft</p>{{/case}}{{#case "pending" break=true}}<span class="status status-error text-capitalize">Pending Authorisation</span>{{/case}}{{#case "rejected" break=true}}<span class="status status-error text-capitalize">Rejected by Customer</span>{{/case}}{{#case "expired" break=true}}<span class="status status-error text-capitalize">Expired</span>{{/case}}{{#case "submitted" break=true}}<span class="status status-good text-capitalize">Submitted for processing</span>{{/case}}{{#default}}<span class="status status-error text-capitalize">{{submitStatus}}</span>{{/default}}{{/switch}}</div></div><div class="result-item-cell"><a class="agent title-day" href="{{linkPosRequest}}?sgServicePortalSubmitRef={{submitRef}}"><p class="bt4 text-color">{{status}}</p><p class="bt4">at {{#formatDate}}{{ lastUpdatedOn}}{{/formatDate}}</p><svg class="icon-xs hide-on-fallback" role="img" title="icon-life-primary"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+Site.vars.assetPath+'icons/icons.svg#arrow-2ndg"><image class="icon-fallback" src="'+Site.vars.assetPath+'icons/arrow-2ndg.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></use></svg></a></div></div>{{/each}}</div>',c=function(e){for(var t={},a=[],i=0;i<e.length;i++)"status"===e[i].name?(a.push(e[i].value),t.status=a):t[e[i].name]=e[i].value;return t},m=function(a,i,s){var o=a.find(".loading-result"),d=a.find("[data-id=no-result]"),r=a.find("[data-id=service-error]"),c=a.find("[data-id=filter-result]"),m=Site.getSessionInfo();o.removeClass("hidden"),!d.hasClass("hidden")&&d.addClass("hidden"),!r.hasClass("hidden")&&r.addClass("hidden"),c.html(""),i.filterAgentLeader=!!n,i.agentNum&&(i.filterAgentLeader=!1),localStorage.getItem("filterDashboard")||i.agentNum||(i.agentNum=m.agent&&m.agent.agentNum||""),Site.ajaxUtil(s,a.find("#filter-form").attr("method"),"json",JSON.stringify(i),function(i){if(i.total){var s=t.Handlebars.compile(l);e.each(i.data,function(e){var t=i.data[e];t.status=Site.getSubStatus(t.submitStatus),t.linkPosRequest=a.data("link-pos")}),o.addClass("hidden"),c.html(s(i.data))}else o.addClass("hidden"),d.removeClass("hidden");if(i.team&&i.team.length&&a.find("[data-id=leader-select] option").length<=1){var n="";e.each(i.team,function(e,t){n+='<option value="'+t.agentNum+'">'+t.agentName+"</option>"}),a.find("[data-id=leader-select]").append(n)}},function(e){throw o.addClass("hidden"),r.removeClass("hidden"),e})};function u(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}u.prototype={init:function(){var a,i=this,s=i.element,n=i.options,o=s.find(n.form);Site.renderTitlePage(),(a=location.search.substring(1)?decodeURI(location.search.substring(1)).split("&"):null)&&e.each(a,function(t,a){var i=a.split("=");e("[name="+i[0]+"]").is(":checkbox")?e("#"+i[0]+"-"+i[1]).prop("checked",!0):e("[name="+i[0]+"]").val(i[1])}),i.initMonthFilter(),i.filterURL=o.attr("action");var l=c(d(s,o.serializeArray()));m(s,l,i.filterURL),i.showHideFilter(),i.sendFilterParams(),i.clearFilter(),localStorage.getItem("filterDashboard")&&(s.find("[data-id=leader-block]").removeClass("hidden"),s.find("[data-id=leader-btn]").off(r.click).on(r.click,function(){var e=c(d(s,o.serializeArray()));e.agentNum=s.find("[data-id=leader-select]").val(),m(s,e,i.filterURL)})),Site.checkPermission("srp_search_view_all",function(){s.find("[data-search-bar]").remove()}),Site.checkPermission("srp_filter_view_all",function(){s.find("[data-filter-bar]").remove()}),t.location.href.match(/\?./)&&s.find("[data-id=accordion-expand]").trigger(r.click)},showHideFilter:function(){var t=this.element,a=t.find("[data-id=accordion-expand]"),i=t.find("[data-id=accordion-collapse]");a.off(r.click).on(r.click,function(){t.find(".filter-field").slideDown(),e(this).addClass("hide"),i.removeClass("hide")}),i.off(r.click).on(r.click,function(){t.find(".filter-field").slideUp(),e(this).addClass("hide"),a.removeClass("hide")})},sendFilterParams:function(){var e,t=this,a=t.element,i=t.options;a.find(i.form+", .sort-by").off(r.change).on(r.change,function(){e=d(a,a.find(i.form).serializeArray()),o(e),m(a,c(e),t.filterURL)})},clearFilter:function(){var e,t=this,a=t.element,i=t.options;a.find("[data-id=clear-filter]").off(r.click).on(r.click,function(){a.find(i.form).trigger("reset"),a.find(i.form+" input[type=checkbox]").removeAttr("checked"),e=d(a,a.find(i.form).serializeArray()),o(e),m(a,c(e),t.filterURL)})},destroy:function(){e.removeData(this.element[0],i)},initMonthFilter:function(){for(var t=new Date,a=t.getMonth()+1,i=t.getFullYear(),s=0;s<12;s++){var n=("0"+a).slice(-2);e(".month-filter").append(e("<option>",{value:i+"-"+n,text:n+"/"+i})),1===a?(a=12,i--):a--}}},e.fn[i]=function(t,a){return this.each(function(){var s=e.data(this,i);s?s[t]&&s[t](a):e.data(this,i,new u(this,t))})},e.fn[i].defaults={form:"#filter-form"},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="footer-fix";function s(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}s.prototype={init:function(){var e,t=this;Site.vars.winElem.on("load",function(){t.footerHeight()}),e=Site.vars.winElem.width(),Site.vars.winElem.on("resize."+i,function(){var a=Site.vars.docElem.width();e!==a&&(e=a,t.footerHeight())})},footerHeight:function(){var t=this.options,a=e(t.classFooter).height(),i=e(t.classHeader).height();e(t.classFooter).css("opacity","1"),e(t.classMain).removeAttr("style"),e(t.classMain).css("min-height",Site.vars.winElem.height()-a-i)},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var n=e.data(this,i);n?n[t]&&n[t](a):e.data(this,i,new s(this,t))})},e.fn[i].defaults={classHeader:"header",classFooter:".footer",classMain:".main-wrapper"},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="header-bar";function s(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}s.prototype={init:function(){this.initDOM(),this.dy=null,this.dyPrev=0,this.scrollDetectRefreshInterval=250,this.slimY=this.navBar.height()-this.slimBar.height(),this.setElementSizes(),Site.vars.winElem.on("scroll.aia.navbar",function(){this.didScroll=!0}.bind(this)),this.screenSmallMediaQuery.addListener(this.setElementSizes.bind(this)),this.screenShmediumMediaQuery.addListener(this.setElementSizes.bind(this)),this.checkScrollInterval=setInterval(function(){this.didScroll&&(this.hasScrolled(),this.didScroll=!1)}.bind(this),this.scrollDetectRefreshInterval)},initDOM:function(){this.navBar=this.element.find(".navbar.navbar-default"),this.navBarZero=this.navBar.find(".navbar-zero"),this.slimBar=this.navBar.find(".navbar-slim"),this.screenSmallMediaQuery=t.matchMedia("(min-width: 768px)"),this.screenShmediumMediaQuery=t.matchMedia("(min-width: 1025px)")},setElementSizes:function(){this.screenShmediumMediaQuery.matches?this.navBarZero.length&&this.navBarZero.is(":visible")?this.navBarOffsetClass="navbar-offset-sd-zero":this.navBarOffsetClass="navbar-offset-sd":this.screenSmallMediaQuery.matches?this.navBarOffsetClass="navbar-offset-sm":e("body.ie8").length>0?this.navBarOffsetClass="navbar-offset-sd":this.navBarOffsetClass="navbar-offset-xs",this.navBar.hasClass("navbar-fixed-slim")&&(this.navBar.removeClass("navbar-offset-xs navbar-offset-sm navbar-offset-sd navbar-offset-sd-zero"),this.navBar.addClass(this.navBarOffsetClass))},hasScrolled:function(){this.dy=Site.vars.winElem.scrollTop(),Math.abs(this.dyPrev-this.dy)<=this.delta||(this.dy>this.dyPrev&&this.dy>this.slimY?(this.navBar.addClass("navbar-fixed-slim").addClass(this.navBarOffsetClass),this.slimBar.on("mouseenter.aia.navbar",this.hoverExpandNavBar.bind(this))):(this.navBar.removeClass("navbar-fixed-slim"),this.navBar.removeClass("navbar-offset-xs navbar-offset-sm navbar-offset-sd navbar-offset-sd-zero"),this.slimBar.off("mouseenter.aia.navbar")),this.dyPrev=this.dy)},hoverExpandNavBar:function(){this.screenShmediumMediaQuery.matches&&(this.navBar.removeClass("navbar-fixed-slim"),this.navBar.removeClass("navbar-offset-xs navbar-offset-sm navbar-offset-sd navbar-offset-sd-zero"),this.navBar.on("mouseleave.aia.navbar",this.hoverShrinkNavbar.bind(this)))},hoverShrinkNavbar:function(){this.navBar.addClass("navbar-fixed-slim").addClass(this.navBarOffsetClass),this.navBar.off("mouseleave.aia.navbar")},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var n=e.data(this,i);n?n[t]&&n[t](a):e.data(this,i,new s(this,t))})},e.fn[i].defaults={},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="load-dashboard",s={click:"click."+i},n=Site.vars.assetPath;function o(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}o.prototype={init:function(){var t=this,a=t.options;t.vars={showDefault:2,size:parseInt(a.size),isLoadUam:!1},Site.renderTitlePage(),t.loadUam(),e("body a").off(s.click).on(s.click,function(){if(!0===t.vars.isLoadUam)return!1}),t.element.off(s.click,a.class.btnShowMore).on(s.click,a.class.btnShowMore,function(a){a.preventDefault(),t.showMore(e(this))}),Site.getSessionInfo().agent&&Site.getSessionInfo().agent.agentClass>=30&&(t.element.siblings("[data-id=member-view]").removeClass("hidden"),t.element.siblings("[data-id=member-view]").off(s.click).on(s.click,function(){localStorage.setItem("filterDashboard","member")}))},initDomAndLoadData:function(){this.initDom(),this.loadData()},loadUam:function(){var e=this;"false"===localStorage.isDemoSso?(console.log("remove isDemoSso attribute "+new Date),localStorage.removeItem("isDemoSso"),e.vars.isLoadUam=!0,Site.ajaxUtil(e.options.linkUam,e.options.method,"json",null,function(t){e.vars.isLoadUam=!1,t.data.uamResponse&&localStorage.setItem("userPermission",t.data.uamResponse),e.initDomAndLoadData()},function(){console.log("load uam error")})):e.initDomAndLoadData()},initDom:function(){this.btnShowMore=this.element.find("[data-id=show-more]"),this.loading=this.element.siblings("[data-id=loading-processing]"),this.noResultText=this.element.siblings("[data-id=no-result]"),this.errorResultText=this.element.siblings("[data-id=error-result]"),this.template={listWapper:'{{#each .}}{{#ifNumCond 0 this.total}}{{#checkPermission "srp_dash_view_sr"}}<div class="result margin-bottom-3xl"><div class="result-header clearfix" data-id="status" data-status ="{{@key}}"> <div class="h6 pull-left padding-bottom-xxs">{{#ifEquals @key "draft"}}<span class="padding-right-xxs">DRAFT</span>{{/ifEquals}}{{#ifEquals @key "pending"}}<span class="padding-right-xxs">PENDING AUTHORISATION</span>{{/ifEquals}}{{#ifEquals @key "rejected"}}<span class="padding-right-xxs">REJECTED BY CUSTOMER</span>{{/ifEquals}}{{#ifEquals @key "expired"}}<span class="padding-right-xxs">EXPIRED</span>{{/ifEquals}}{{#ifEquals @key "submitted"}}<span class="padding-right-xxs">SUBMITTED FOR PROCESSING</span>{{/ifEquals}}<span>({{total}})</span></div>{{#checkPermission "srp_dash_view_all"}}<a class="lk1 pull-right" href="{{linkFilter}}" data-id="see-all">{{SEEALLTEXT}}<span class="link-arrow"></span></a>{{/checkPermission}}</div><div class="result-table" data-id="result-table">{{#each data}}{{#ifNumCond @index 2}}<div class="result-item padding-top-s padding-bottom-s card-vertical-separator-bottom"><div class="thumbnail result-item-cell">{{#ifEquals policyHolderGender "M"}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#malepressed-prime1"></use><image class="icon-fallback" src="'+n+'icons/malepressed-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{else}}<svg class="icon-m hide-on-fallback" role="img" title="icon-life-primary"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#femalepress-prime1"></use><image class="icon-fallback" src="'+n+'icons/femalepress-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}<div class="agent"><h5 class="title-text">{{{policyHolderName}}}</h5><p class="bt4 b6">{{#each serviceRequest}}{{#ifEquals @index 0}}{{description}} {{/ifEquals}}{{/each}}{{#ifNumCond 1 serviceRequest.length }} (+{{math serviceRequest.length "-" 1}}) {{/ifNumCond}}</p>{{#ifEquals submitStatus "draft"}}<span class="status text-capitalize">Draft</p>{{/ifEquals}}{{#ifEquals submitStatus "pending"}}<span class="status status-error text-capitalize">Pending Authorisation</span>{{/ifEquals}}{{#ifEquals submitStatus "rejected"}}<span class="status status-error text-capitalize">Rejected by Customer</span>{{/ifEquals}}{{#ifEquals submitStatus "expired"}}<span class="status status-error text-capitalize">Expired</span>{{/ifEquals}}{{#ifEquals submitStatus "submitted"}}<span class="status status-good text-capitalize">Submitted for processing</span>{{/ifEquals}} </div></div><div class="result-item-cell">{{#checkPermission "srp_dash_action_sr"}}<a class="agent title-day" href="{{linkPosRequest}}?sgServicePortalSubmitRef={{submitRef}}"><p class="bt4"> {{#getSubStatus }}{{submitStatus}}{{/getSubStatus}} on {{#formatDate}}{{lastUpdatedOn}}{{/formatDate}} </p><svg class="icon-xs hide-on-fallback" role="img" title="arrow-2ndg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#arrow-2ndg"></use><image class="icon-fallback" alt="arrow-2ndg" src="'+n+'icons/arrow-2ndg.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></a>{{/checkPermission}}</div></div>{{/ifNumCond}}{{/each}}{{#checkPermission "srp_dash_view_all"}}{{#ifNumCond 2 data.length}}{{LOADING}}<div class="result-load-more"><a class="s5 bt4 pull-left" href="#" data-size={{SIZE}} data-id="show-more">View more<span class="link-arrow-down"></span></a></div>{{/ifNumCond}}{{/checkPermission}}</div></div>{{/checkPermission}}{{/ifNumCond}}{{/each}}',itemList:'{{#each. }}<div class="result-item padding-top-s padding-bottom-s card-vertical-separator-bottom"><div class="thumbnail result-item-cell">{{#ifEquals policyHolderGender "M"}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#malepressed-prime1"></use><image class="icon-fallback" src="'+n+'icons/malepressed-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{else}}<svg class="icon-m hide-on-fallback" role="img" title="icon-life-primary"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#femalepress-prime1"></use><image class="icon-fallback" src="'+n+'icons/femalepress-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}<div class="agent"><h5 class="title-text">{{{policyHolderName}}}</h5><p class="bt4 b6">{{#each serviceRequest}}{{#ifEquals @index 0}}{{description}} {{/ifEquals}}{{/each}}{{#ifNumCond 1 serviceRequest.length }} (+{{math serviceRequest.length "-" 1}}) {{/ifNumCond}}</p>{{#ifEquals submitStatus "draft"}}<span class="status text-capitalize">Draft</p>{{/ifEquals}}{{#ifEquals submitStatus "pending"}}<span class="status status-error text-capitalize">Pending Authorisation</span>{{/ifEquals}}{{#ifEquals submitStatus "rejected"}}<span class="status status-error text-capitalize">Rejected by Customer</span>{{/ifEquals}}{{#ifEquals submitStatus "expired"}}<span class="status status-error text-capitalize">Expired</span>{{/ifEquals}}{{#ifEquals submitStatus "submitted"}}<span class="status status-good text-capitalize">Submitted for processing</span>{{/ifEquals}} </div></div><div class="result-item-cell">{{#checkPermission "srp_dash_action_sr"}}<a class="agent title-day" href="{{linkPosRequest}}?sgServicePortalSubmitRef={{submitRef}}"><p class="bt4"> {{#getSubStatus }}{{submitStatus}}{{/getSubStatus}} on {{#formatDate}}{{lastUpdatedOn}}{{/formatDate}} </p><svg class="icon-xs hide-on-fallback" role="img" title="arrow-2ndg"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#arrow-2ndg"></use><image class="icon-fallback" alt="arrow-2ndg" src="'+n+'icons/arrow-2ndg.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></a>{{/checkPermission}}</div></div>{{/each}}'}},loadData:function(){var a=this,i=a.options.class,n={sessionInfo:Site.getCookie("sessionInfo")},o=!1;if(Site.checkPermission("srp_dash_view_sr",function(){o=!0,a.errorResultText.removeClass(i.hidden).find("h6").html("YOU MAY HAVE NOT PERMISSION TO VIEW DASHBOARD.")}),o)return!1;a.loading.removeClass(i.hidden),Site.ajaxUtil(a.options.url,a.options.method,"json",JSON.stringify(n),function(n){if(n.total>0){var o=n.data;e.each(o,function(e,t){t.linkFilter=a.options.link+"?status="+e.split(" ")[0].toLowerCase()}),a.vars.data=o;var d=a.loading.addClass(i.hidden).clone(),r=a.template.listWapper;r=r.replace("{{SIZE}}","0").replace("{{SEEALLTEXT}}",a.element.data("see-all-text")||"See All").replace("{{LOADING}}",d[0].outerHTML).replace("{{linkPosRequest}}",a.options.linkPos);var l=t.Handlebars.compile(r)(a.vars.data);a.element.append(l),a.loading.addClass(i.hidden),a.element.off(s.click,"[data-id=see-all]").on(s.click,"[data-id=see-all]",function(){localStorage.removeItem("filterDashboard")})}else a.noResultText.removeClass(i.hidden),a.loading.addClass(i.hidden)},function(e,t){"502"===t.status?a.errorResultText.html("<h6>Bad Gateway</h6>"):a.errorResultText.html("<h6>"+e.message+"</h6>"),a.errorResultText.removeClass(i.hidden),a.loading.addClass(i.hidden)})},showMore:function(a){var i=this,s=this.options.class,n=a.parents(s.resultTable).siblings(s.idStatus).data("status"),o=parseInt(a.data("size")),d=[],r=o+i.vars.showDefault,l=r+i.vars.size;i.loading.removeClass(s.hidden),e.each(i.vars.data[n].data,function(e,t){e>=r&&e<l&&d.push(t)}),a.data("size",o+i.vars.size),i.vars.data[n].total<=l&&a.parent().addClass(s.hidden);var c=i.template.itemList;c=c.replace("{{linkPosRequest}}",i.options.linkPos);var m=t.Handlebars.compile(c)(d);a.parent().siblings("[data-id=loading-processing]").before(m),i.loading.addClass(s.hidden)},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var s=e.data(this,i);s?s[t]&&s[t](a):e.data(this,i,new o(this,t))})},e.fn[i].defaults={class:{hidden:"hidden",active:"active",loading:"[data-id=loading-processing]",resultTable:"[data-id=result-table]",idStatus:"[data-id=status]",btnShowMore:"[data-id=show-more]"}},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="load-information",s={click:"click."+i};function n(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}n.prototype={init:function(){var t=this;t.initDom(),t.LoadData(),t.element.off(s.click,t.options.class.btnShowMore).on(s.click,t.options.class.btnShowMore,function(a){a.preventDefault();var i=e(this).parents(t.options.class.tabContent),s=i.attr("id");t.renderHTMLItem(i,s)}),t.element.off(s.click,"[data-id=btnSubmitCustomer]").on(s.click,"[data-id=btnSubmitCustomer]",function(a){a.preventDefault();var i=t.element.find(".customer-information"),s={};s.customerId=i.data("customer-id"),s.customerName=i.data("customer-name"),s.customerGender=i.data("customer-gender"),s.policyId=e(this).data("policy-id"),s.sourceSystem=e(this).data("source-system"),t.sendFormCustomer(s)})},initDom:function(){this.container=this.element.find("[data-id=data-container]"),this.loading=this.element.find("[data-id=loading-processing]"),this.errorResultText=this.element.find("[data-id=error-result]"),this.template={wrapper:'<div class="thumbnail">{{#ifEquals customer.gender "M"}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+Site.vars.assetPath+'icons/icons.svg#malepressed-prime1"></use><image class="icon-fallback" src="'+Site.vars.assetPath+'icons/malepressed-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{else}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+Site.vars.assetPath+'icons/icons.svg#femalepress-prime1"></use><image class="icon-fallback" src="'+Site.vars.assetPath+'icons/femalepress-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}</div><div class="info-area"><div class="title"><h4>{{customer.fullNm}}</h4></div></div><div class="information">{{#checkPermission "srp_cus_profile_pol_personal"}}<div class="customer-information"data-customer-id="{{customer.idNum}}"data-customer-name="{{customer.fullNm}}"data-customer-gender="{{customer.gender}}"><div class="row"><div class="col-sm-4"><span class="bt8">Customer Number</span><span class="bt10">{{#if customer.idNum}}{{customer.idNum}}{{else}}-{{/if}}</span></div><div class="col-sm-4"><span class="bt8">Date Of Birth</span><span class="bt10">{{#if customer.birthDt}}{{customer.birthDt}}{{else}}-{{/if}}</span></div><div class="col-sm-4"><span class="bt8">Nationality</span><span class="bt10">{{#if customer.nationality}}{{customer.nationality}}{{else}}-{{/if}}</span></div></div></div><div class="contact-information"><div class="row"><div class="col-sm-4"><span class="bt8">Home Number</span><span class="bt9">{{#if customer.phone.0.phoneNo}}{{customer.phone.0.phoneNo}}{{else}}-{{/if}}</span></div><div class="col-sm-4"><span class="bt8">Mobile Number</span><span class="bt9">{{#if customer.phone.1.phoneNo}}{{customer.phone.1.phoneNo}}{{else}}-{{/if}}</span></div><div class="col-sm-4"><span class="bt8">E-mail</span><span class="bt9">{{#if customer.email.0.emailAddress}}{{customer.email.0.emailAddress}}{{else}}-{{/if}}</span></div></div></div>{{/checkPermission}}{{#checkPermission "srp_cus_profile_pol_detail"}}<div class="policy" data-id="data-container"><h5 class="margin-bottom-xs">All policies<span class="count" data-id="count-result">({{totalPolicy}})</span></h5>{{#ifNumCond 0 totalPolicy}}<div class="padding-top-m padding-bottom-m"><ul class="nav-switch" role="tablist">{{#each policy}} <li class="{{#ifEquals @index 0 }} active {{/ifEquals}}" role="presentation"><a class="h6 p3" href="#{{@key}}" title="{{@key}}" aria-controls="{{@key}}" role="tab" data-toggle="tab"><span>{{@key}}</span></a></li>{{/each}}</ul><div class="tab-content">{{#each policy}}<div class="tab-pane fade {{#ifEquals @index 0 }} in active {{/ifEquals}}" id="{{@key}}" data-load role="tabpanel">{{#each this}}{{#ifNumCond @index '+this.options.showDefault+'}}<div class="block card-6 card-border-top-grey"><div class="thumbnail">{{#if srcImg}}<image class="icon-fallback" src="{{srcImg}}" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image>{{/if}}</div><div class="content"><div class="title margin-bottom-xs"><h4>{{planName}}</h4><p class="description">{{#if prodCategory}}<span class="tag">{{prodCategory}}</span>{{/if}}</p></div>{{#ifNumCond 0 rider.length}}<div class="policy-riders"><div class="card-vertical-separator-top padding-top-m padding-bottom-m"><div class="policy-rider-title">{{#rider}}{{#ifNumCond @index 1}}<span class="policy-rider-title-text h5">{{riderName}}</span>{{/ifNumCond}}{{/rider}}{{#ifNumCond 1 rider.length}}<span class="lk1" href="#" title="{{math rider.length "-" 1}} more addons">{{math rider.length "-" 1}} more addons</span>{{/ifNumCond}}</div></div></div>{{/ifNumCond}}<div class="card-vertical-separator-top"><div class="policy-details margin-bottom-xxs margin-top-xxs"><p>Policy Number:<span class="number"><strong data-policy-number="{{polNum}}" >{{polNum}}</strong></span></p><p>Premium Status:<span class="number"><strong>{{#if premiumStatusDesc}}{{premiumStatusDesc}}{{else}}-{{/if}}</strong></span></p><p>Covers:<span class="number"><strong>{{#participantList participant "LF"}}{{/participantList}}</strong></span></p></div>{{#checkPermission "srp_cus_profile_action_sr"}}<div class="submission">{{#ifEqualAgentNum servicingAgent}}<button data-id="btnSubmitCustomer" class="btn btn-default btn-secondary"data-source-system="{{sourceSystem}}"data-policy-id="{{polNum}}" type="submit">Submit Pos Request</button>{{else}}{{#ifEqualAgentClass}}<button data-id="btnSubmitCustomer" class="btn btn-default btn-secondary"data-source-system="{{sourceSystem}}"data-policy-id="{{polNum}}" type="submit">Submit Pos Request</button>{{/ifEqualAgentClass}}{{/ifEqualAgentNum}}</div>{{/checkPermission}}</div></div></div>{{/ifNumCond}}{{/each}}{{#ifNumCond '+this.options.showDefault+' this.length }}<div class="show-more" data-id="show-more"><a class="lk1 load-info" href="#" title="Show more"><span>Show more</span><svg class="icon-s icon-32  hide-on-fallback" role="img" title="accarrowdn-glyph"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+Site.vars.assetPath+'icons/icons.svg#accarrowdn-glyph"></use><image class="icon-fallback" alt="accarrowdn-glyph" src="'+Site.vars.assetPath+'icons/accarrowdn-glyph.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg></a></div>{{/ifNumCond}}</div>{{/each}}</div></div>{{/ifNumCond}}</div>{{/checkPermission}}</div>',listItem:'{{#each .}}<div class="block card-6 card-border-top-grey"><div class="thumbnail">{{#if srcImg}}<image class="icon-fallback" src="{{srcImg}}" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image>{{/if}}</div><div class="content"><div class="title margin-bottom-xs"><h4>{{planName}}</h4><p class="description">{{#if prodCategory}}<span class="tag">{{prodCategory}}</span>{{/if}}</p></div><div class="policy-riders"><div class="card-vertical-separator-top padding-top-m padding-bottom-m"><div class="policy-rider-title">{{#rider}}{{#ifNumCond @index 1}}<span class="policy-rider-title-text h5">{{riderName}}</span>{{/ifNumCond}}{{/rider}}{{#ifNumCond 1 rider.length}}<span class="lk1" href="#" title="{{math rider.length "-" 1}} more addons">{{math rider.length "-" 1}} more addons</span>{{/ifNumCond}}</div></div></div><div class="card-vertical-separator-top"><div class="policy-details margin-bottom-xxs margin-top-xxs"><p>Policy Number:<span class="number"><strong>{{polNum}}</strong></span></p><p>Premium Status:<span class="number"><strong>{{#if premiumStatusDesc}}{{premiumStatusDesc}}{{else}}-{{/if}}</strong></span></p><p>Covers:<span class="number"><strong>{{#participantList participant "LF"}}{{/participantList}}</strong></span></p></div>{{#checkPermission "srp_cus_profile_action_sr"}}<div class="submission">{{#ifEqualAgentNum servicingAgent}}<button data-id="btnSubmitCustomer" class="btn btn-default btn-secondary"data-source-system="{{sourceSystem}}"data-policy-id="{{polNum}}" type="submit">Submit Pos Request</button>{{else}}{{#ifEqualAgentClass}}<button data-id="btnSubmitCustomer" class="btn btn-default btn-secondary"data-source-system="{{sourceSystem}}"data-policy-id="{{polNum}}" type="submit">Submit Pos Request</button>{{/ifEqualAgentClass}}{{/ifEqualAgentNum}}</div>{{/checkPermission}}</div></div></div>{{/each}}'}},LoadData:function(){var a=this,i=a.options.class,s={idNum:a.element.data("customer-id")},n=Site.getPermission("srp_cus_profile_pol_detail"),o=Site.getPermission("srp_cus_profile_pol_personal");n&&"00"===n.securityLevel&&o&&"00"===o.securityLevel&&(t.location=e("#async-script").data("forbidden-path")),a.element.data("customer-id")?(a.loading.removeClass(i.hidden),Site.ajaxUtil(a.options.ajax,a.options.method,"json",JSON.stringify(s),function(s){if(200!==s.statusCode)return a.errorResultText.removeClass(i.hidden).find("h6").text(s.message),a.loading.addClass(i.hidden),!1;s.data.customer?(t._.isEmpty(t.policyIcons)||(e.each(s.data.policy,function(a,i){e.each(i,function(e,a){var i="AIA VITALITY",s=t.policyIcons[a.prodCategory.toUpperCase()]||"";"TRAVEL AND LIFESTYLE"===a.prodCategory.toUpperCase()&&a.planName.toUpperCase()===i&&(s=t.policyIcons[i]),!s&&(s=t.policyIcons[Object.keys(t.policyIcons)[0]]),a.srcImg=s})}),a.renderHTML(s)),a.objectData=s.data.policy):"edit"!==e("#async-script").data("cq-mode")&&t.location.replace(e("#async-script").data("404-path")),a.loading.addClass(i.hidden)},function(e){throw a.errorResultText.removeClass(i.hidden).find("h6").text(e.message),a.loading.addClass(i.hidden),e})):"edit"!==e("#async-script").data("cq-mode")&&t.location.replace(e("#async-script").data("404-path"))},renderHTML:function(a){a.data.totalPolicy&&a.data.totalPolicy>0&&e.each(a.data.policy,function(t,i){i.length?e.each(i,function(t,a){var i=[];a.rider.length&&e.each(a.rider,function(e,t){t.dummyInd&&"Y"===t.dummyInd||i.push(t)}),a.rider=i}):delete a.data.policy[t]});var i=t.Handlebars.compile(this.template.wrapper)(a.data);this.container.prepend(i),this.loading.addClass(this.options.class.hidden)},renderHTMLItem:function(a,i){var s=this,n=s.options.class,o=[];e.each(s.objectData[i],function(t,a){if(t>=parseInt(s.options.showDefault)){var i=[];a.rider.length&&e.each(a.rider,function(e,t){t.dummyInd&&"Y"===t.dummyInd||i.push(t)}),a.rider=i,o.push(a)}});var d=t.Handlebars.compile(s.template.listItem)(o);a.append(d),a.find(n.btnShowMore).addClass(n.hidden)},sendFormCustomer:function(e){var a=this,i={customerId:e.customerId,customerName:e.customerName,customerGender:e.customerGender,policyId:e.policyId,sourceSystem:e.sourceSystem};Site.ajaxUtil(a.options.urlSubmitPos,a.options.method,"json",JSON.stringify(i),function(e){200===e.statusCode&&(t.location.href=a.options.urlRedirectPage+"?sgServicePortalSubmitRef="+e.submitRef)},function(e){throw e})},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var s=e.data(this,i);s?s[t]&&s[t](a):e.data(this,i,new n(this,t))})},e.fn[i].defaults={class:{hidden:"hidden",active:"active",tabContent:".tab-pane",btnShowMore:"[data-id=show-more]"},showDefault:3},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="login-handle";function s(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}s.prototype={init:function(){var e=this;e.messageError=e.element.find("#login-error"),e.element.submit(function(t){t.preventDefault(),e.loginRequest()})},loginRequest:function(){var t=this,a=Site.serializeObject(t.element.serializeArray());e.ajax({url:t.element.attr("action"),type:t.element.attr("method"),data:Site.encryptedData(JSON.stringify(a)),dataType:"json",contentType:"application/json",success:function(e){if(t.messageError.text(""),200===e.statusCode){var a={statusCode:e.statusCode,jSessionId:e.data.jSessionId,sessionInfo:e.data.sessionInfo,jwtToken:e.data.jwtToken};e.data.uamResponse&&localStorage.setItem("userPermission",e.data.uamResponse),t.loginResponse(a)}else t.messageError.text(e.message)},error:function(e){throw t.messageError.text(e.message),e}})},loginResponse:function(a){var i=this;e.ajax({url:i.element.data("url-aem"),type:i.element.attr("method"),data:JSON.stringify(a),dataType:"json",contentType:"application/json",success:function(e){e.url&&t.location.replace(e.url)},error:function(e){i.messageError=e}})},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var n=e.data(this,i);n?n[t]&&n[t](a):e.data(this,i,new s(this,t))})},e.fn[i].defaults={defaultPath:"/searchtest.html"},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i="login-sso";function s(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}s.prototype={init:function(){this.checkingToken()},checkingToken:function(){var t,a,i=this,s=i.element,n=i.options;s.submit(function(o){o.preventDefault(),a=function(e){for(var t={},a=0;a<e.length;a++)t[e[a].name]=e[a].value;return t}(s.serializeArray()),(t=e.extend({},a)).handOffAppId="LMSADMINAPP"===a.handOffAppId?"INTERNALACCESSAPP":"AGENTACCESSAPP",e.ajax({url:n.serviceUrl,method:"POST",data:JSON.stringify(t),dataType:"json",contentType:"application/json",success:function(t){i.sendToken(e.extend({},t,{handOffAppId:a.handOffAppId}))},error:function(e){throw e}})})},sendToken:function(t){var a=this;e.ajax({url:this.options.loginSsoUrl,method:"POST",data:JSON.stringify({ssoToken:t.otp,handOffAppId:t.handOffAppId}),dataType:"json",contentType:"application/json",success:function(e){var t={};200===e.statusCode?(t={statusCode:e.statusCode,jSessionId:e.data.jSessionId,sessionInfo:e.data.sessionInfo,jwtToken:e.data.jwtToken},e.data.uamResponse&&localStorage.setItem("userPermission",e.data.uamResponse)):509===e.statusCode||510===e.statusCode?!a.element.find(".error-sso").length&&a.element.append('<p class="u2 error-sso">'+e.message+"</p>"):t=e,509!==e.statusCode&&a.loginResponse(t)},error:function(e){throw e}})},loginResponse:function(t){t.data?(e.each(t.data,function(t,a){e('<input type="hidden" name="'+t+'"/>').val(a).appendTo("#login-sso")}),e('<input type="hidden" name="statusCode"/>').val(t.statusCode).appendTo("#login-sso"),e('<input type="hidden" name="isDemoSso"/>').val("true").appendTo("#login-sso")):(e.each(t,function(t,a){e('<input type="hidden" name="'+t+'"/>').val(a).appendTo("#login-sso")}),e('<input type="hidden" name="isDemoSso"/>').val("true").appendTo("#login-sso")),e("#login-sso").submit()},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var n=e.data(this,i);n?n[t]&&n[t](a):e.data(this,i,new s(this,t))})},e.fn[i].defaults={},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i,s="logout-request",n=0,o="",d={click:"click."+s};function r(t,a){this.element=e(t),this.options=e.extend({},e.fn[s].defaults,this.element.data(),a),this.init()}r.prototype={init:function(){t.location.pathname===this.options.loginPath?this.element.find("[data-id=search-btn], [data-id=signout-btn]").addClass("hidden"):(this.idleLogout(),this.confirmLogout())},idleLogout:function(){var t=this,a=t.options,s=e("[data-id=idle-logout-modal]"),d=function(){i=setInterval(function(){if(++n>=a.idle){s.modal("show"),clearInterval(i);var r=setTimeout(function(){o="SYS",s.hide(),e(".modal-backdrop").remove();var a=e(this).hasClass("save-draft");a&&e("[data-add-services]")["add-services"]("saveAsDraftAction",function(){t.logoutRequest()}),!a&&t.logoutRequest()},6e4*a.logoutAfter);s.on("hidden.bs.modal",function(){clearTimeout(r),clearInterval(i),d()})}},6e4*a.countTime)};d(),Site.vars.docElem.on("mousemove click keydown",function(){n&&(n=0)})},confirmLogout:function(){var t=this;e("[data-id=logout-btn]").off(d.click).on(d.click,function(){o="USER";var a=e(this).hasClass("save-draft");a&&e("[data-add-services]")["add-services"]("saveAsDraftAction",function(){t.logoutRequest()}),!a&&t.logoutRequest()})},logoutRequest:function(){var t=this,a=t.options.logoutApi,s=e("[data-id=logout-confirm-modal]"),n={logoutBy:o};Site.ajaxUtil(a,"POST","json",JSON.stringify(n),function(a,n,o){var d=Site.getSessionInfo().loginType;200===o.status&&e.ajax({url:t.options.logoutServlet,method:"POST",data:JSON.stringify({statusCode:o.status.toString()}),dataType:"json",contentType:"application/json",success:function(e,t,a){200===a.status&&(localStorage.removeItem("userPermission"),localStorage.removeItem("filterDashboard"),clearInterval(i),s.modal("show"),s.on("hidden.bs.modal",function(){Site.vars.winElem.unbind("beforeunload"),Site.redirectLogoutRequest(d)}))},error:function(e){throw e}})},function(e){throw e})},destroy:function(){e.removeData(this.element[0],s)}},e.fn[s]=function(t,a){return this.each(function(){var i=e.data(this,s);i?i[t]&&i[t](a):e.data(this,s,new r(this,t))})},e.fn[s].defaults={logoutUrl:"/bin/logout",loginPath:"/login.html",idle:15,countTime:1,logoutAfter:3},e(function(){e("[data-"+s+"]")[s]()})}(jQuery,window),function(e,t,a){"use strict";var i="search-global",s={click:"click."+i,keyup:"keyup."+i,mouseup:"mouseup."+i},n=Site.vars.assetPath;function o(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}o.prototype={init:function(){var a=this,i=a.options.class;a.initDOM(),a.vars={stringPolicy:"policy",stringCustomer:"customer",stringNational:"national",url:a.formSearch.attr("action"),method:a.formSearch.attr("method"),size:parseInt(a.formSearch.data("size")),maxSize:parseInt(a.formSearch.data("max-size")),currentPage:parseInt(a.formSearch.data("page")),checkSearchTypeCustomer:!1,checkSearchTypePolicy:!1},"FSC"!==Site.getSessionInfo().userType&&a.searchTypeFsc.remove(),Site.checkPermission("srp_global_search",function(){t.location=e("#async-script").data("forbidden-path")}),a.searchBar.off(s.keyup).on(s.keyup,this.onKeyUpSearchBar.bind(this)),a.searchInput.off(s.keyup).on(s.keyup,function(e){e.preventDefault(),a.didKeySuggestion(e)}),e(Site.vars.docElem).off(s.mouseup).on(s.mouseup,function(e){a.formSearch.is(e.target)||0!==a.formSearch.has(e.target).length||a.hideSuggestList(e)}),a.searchSuggestListItems.find("a").off(s.click).on(s.click,function(t){var s=e(this);t.preventDefault(),a.hideSuggestList(t);var n=s.data("type");s.parent().addClass(i.active).siblings().removeClass(i.active),a.vars.searchType=s.data("search-type"),a.tabNav.removeClass(i.hidden),a.vars.currentType=n,a.tabNavItem.removeClass(i.active).addClass("hidden"),n===a.vars.stringPolicy?a.tabPolicy.parent().addClass(i.active).removeClass("hidden"):a.tabCustomer.parent().addClass(i.active).removeClass("hidden"),a.vars.checkSearchTypeCustomer=!1,a.vars.checkSearchTypePolicy=!1,a.showTabContent(n),a.loadDataSearch(n)}),this.tabNavItem.find("[data-toggle=tab]").off(s.click).on(s.click,function(t){t.preventDefault(),a.hideSuggestList();var s=e(this),n=s.data("type");if(n===a.vars.stringPolicy?n=a.vars.stringPolicy:(n=a.searchSuggestList.find("li.active").find("a").data("type"))===a.vars.stringPolicy&&(n=a.vars.stringCustomer),a.vars.currentType===n||a.searchInput.val().length<3)return t.stopPropagation(),void a.searchInput.focus();s.addClass(i.active),a.vars.currentType=n,a.showTabContent(n),(!a.vars.checkSearchTypeCustomer&&n!==a.vars.stringPolicy||!a.vars.checkSearchTypePolicy&&n===a.vars.stringPolicy)&&a.loadDataSearch(n)}),a.btnShowMore.off(s.click).on(s.click,function(e){e.preventDefault(),a.hideSuggestList(),a.loadMoreContent(a.vars.currentType)}),a.formSearch.submit(function(e){e.preventDefault()}),a.element.off(s.click,"[data-id=btnSubmitCustomer]").on(s.click,"[data-id=btnSubmitCustomer]",function(t){t.preventDefault();var i=e(this),s={};s.customerId=i.data("customer-id"),s.customerName=i.data("customer-name"),s.customerGender=i.data("customer-gender"),a.sendFormCustomer(s)}),a.element.off(s.click,"[data-id=btnSubmitPolicy]").on(s.click,"[data-id=btnSubmitPolicy]",function(t){t.preventDefault();var i=e(this),s={};s.customerId=i.data("customer-id"),s.customerName=i.data("customer-name"),s.customerGender=i.data("customer-gender"),s.policyId=i.data("policy-id"),s.sourceSystem=i.data("source-system"),a.sendFormPolicy(s)})},initDOM:function(){this.searchBar=this.element.find("[data-id=inline-searchbar]"),this.formSearch=this.searchBar.find("form"),this.blockSearchType=this.searchBar.find(".search-type"),this.searchType=this.formSearch.find("input[name=search-type]"),this.searchInput=this.formSearch.find("[name=value]"),this.searchSuggestList=this.searchBar.find("[data-id=search-suggest]"),this.searchSuggestListItems=this.searchSuggestList.find("li"),this.searchTypeFsc=this.searchSuggestList.find("[data-id=search-type-fsc]"),this.searchSuggestListFsc=this.searchBar.find("[data-id=search-suggest-fsc]"),this.tabNav=this.element.find("[data-id=tab-nav]"),this.tabNavItem=this.tabNav.find("li"),this.tabPolicy=this.tabNavItem.find("[data-type=policy]"),this.tabCustomer=this.tabNavItem.find("[data-type=customer]"),this.tabResult=this.element.find("[data-id=tab-content]"),this.contentCustomer=this.tabResult.find("[data-id=content-customer]"),this.contentPolicy=this.tabResult.find("[data-id=content-policy]"),this.btnShowMore=this.element.find("[data-id=show-more]"),this.loading=this.element.find("[data-id=loading-processing-bar]"),this.template={customer:'<script type="text/x-handlebars-template">{{#each .}}<div class="result-item padding-top-s padding-bottom-s card-vertical-separator-bottom"><div class="thumbnail result-item-cell">{{#ifEquals gender "M"}}<svg class="icon-m hide-on-fallback" role="img" title="malepressed-prime1"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#malepressed-prime1"></use><image class="icon-fallback" src="'+n+'icons/malepressed-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}{{#ifEquals gender "F"}}<svg class="icon-m hide-on-fallback" role="img" title="icon-life-primary"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+n+'icons/icons.svg#femalepress-prime1"></use><image class="icon-fallback" src="'+n+'icons/femalepress-prime1.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>{{/ifEquals}}<div class="agent">{{#ifEquals role "OW"}}<a class="h5 title-text" href="{{Link}}{{clientNum}}">{{fullNm}}</a>{{else}}<p class="h5 title-text">{{fullNm}}</p>{{/ifEquals}}<p class="bt4">{{idNum}}</p>{{#if birthDt}}<p class="bt4">{{CustomerDateText}} {{birthDt}}</p>{{/if}}</div></div><div class="result-item-cell">{{#checkPermission "srp_cus_profile_action_sr"}}{{#ifEquals role "OW"}}<button data-id="btnSubmitCustomer"data-customer-id="{{idNum}}"data-customer-name="{{fullNm}}"data-customer-gender="{{gender}}"class="submit-pos link-pos btn btn-default btn-secondary" type="button">{{SubmitRequest}}</button>{{/ifEquals}}{{/checkPermission}}</div></div>{{/each}}<\/script>',policy:'<script type="text/x-handlebars-template">{{#each .}}<div class="result-item result-item-style1 padding-top-s padding-bottom-s card-vertical-separator-bottom"><div class="result-item-cell"><div class="agent"><h5 class="h5 title-text">{{polNum}}</h5><p class="bt4">{{planName}}</p></div></div><div class="thumbnail result-item-cell"><div class="agent"><p class="bt4">{{PolicyOwnerText}}</p>{{#each participant}}{{#ifEquals @index 0}}<p class="h5 title-text">{{fullNm}}</p>{{/ifEquals}}{{#ifEquals @index 1}}<p class="bt4">{{fullNm}} {{countParticipant}} </p>{{/ifEquals}}{{/each}} </div></div><div class="result-item-cell">{{#checkPermission "srp_cus_profile_action_sr"}}{{#ifEqualAgentNum servicingAgent}}<button class="submit-pos link-pos btn btn-default btn-secondary"{{#each participant}}{{#ifEquals role "OW"}}data-id="btnSubmitPolicy"data-customer-id="{{idNum}}"data-customer-name="{{fullNm}}"data-customer-gender="{{gender}}"{{/ifEquals}}{{/each}} data-policy-id="{{polNum}}"data-source-system="{{sourceSystem}}"type="button">{{SubmitRequest}}</button>{{else}}{{#ifEqualAgentClass}}<button class="submit-pos link-pos btn btn-default btn-secondary"{{#each participant}}{{#ifEquals role "OW"}}data-id="btnSubmitPolicy"data-customer-id="{{idNum}}"data-customer-name="{{fullNm}}"data-customer-gender="{{gender}}"{{/ifEquals}}{{/each}} data-policy-id="{{polNum}}"data-source-system="{{sourceSystem}}"type="button">{{SubmitRequest}}</button>{{/ifEqualAgentClass}}{{/ifEqualAgentNum}}{{/checkPermission}}</div></div>{{/each}}<\/script>'}},onKeyUpSearchBar:function(e){e.preventDefault(),e.stopPropagation();var t=this.options.class,a=this.searchBar.hasClass(t.open);/(38|40|27|32)/.test(e.which)&&a&&this.searchSuggestListItems.length&&27===e.which&&(this.searchBar.removeClass(t.open),this.searchSuggestList.hide())},didKeySuggestion:function(t){if(!/(38|40|27)/.test(t.which)){var a=this.searchInput.val().trim(),i=this.options.class;a.length>2&&/(13)/.test(t.which)?(this.searchSuggestListItems.each(function(){var t=e(this).find("span"),i=t.data("title")+" "+a;t.text(i)}),this.searchBar.addClass(i.open),this.searchSuggestList.show()):(this.searchBar.removeClass(i.open),this.searchSuggestList.hide())}},hideSuggestList:function(){this.searchBar.removeClass(this.options.open),this.searchSuggestList.hide()},showTabContent:function(e){var t=this,a=t.options.class;e===t.vars.stringPolicy?(t.contentPolicy.removeClass(a.hidden),t.contentCustomer.addClass(a.hidden)):(t.contentPolicy.addClass(a.hidden),t.contentCustomer.removeClass(a.hidden))},loadDataSearch:function(t){var a=this,i=a.options.class,s=a.searchInput.val().trim().toString(),n=a.vars.url,o=t===a.vars.stringPolicy?a.contentPolicy:a.contentCustomer,d=o.find(".result-table"),r=o.find("[data-id=show-more]"),l=o.find(".count-result"),c={searchType:a.vars.searchType||"exact"};switch(t){case a.vars.stringCustomer:c.name=s,c.idNum="";break;case a.vars.stringNational:c.name="",c.idNum=s;break;default:c.polNum=s}a.showLoading(l),d.addClass(i.hidden),r.addClass(i.hidden),l.addClass(i.hidden),t===a.vars.stringPolicy?(n=this.tabPolicy.data("url"),a.vars.checkSearchTypePolicy=!0):a.vars.checkSearchTypeCustomer=!0,Site.ajaxUtil(n,a.vars.method,"json",JSON.stringify(c),function(i){if(i.data){var s=i;t===a.vars.stringPolicy?(a.vars.dataPolicy=s,e.each(s.data,function(t,a){e.each(a.participant,function(e,t){a.participant.length-2>0&&(t.countParticipant="(+"+(a.participant.length-2)+")")})})):a.vars.dataCustomer=s,a.renderDataSearch(s,t),a.hideLoading()}else a.callAjaxFail(o)},function(e,t){var i=o.find("[data-id=error-result]");"502"===t.status?i.html("<h6>Bad Gateway</h6>"):i.html("<h6>"+e.message+"</h6>"),i.removeClass(a.options.class.hidden),a.loading.addClass(a.options.class.hidden)})},renderDataSearch:function(e,t){var a,i,s=this,n=s.options.class,o=t===s.vars.stringPolicy?s.contentPolicy:s.contentCustomer,d=o.find(".result-table"),r=o.find("[data-id=show-more]"),l=o.find("[data-id=count-result]"),c=o.find("[data-id=notify-max-result]"),m=o.find("[data-id=no-result]");if((a=t===s.vars.stringPolicy?s.vars.dataPolicy?s.vars.dataPolicy.total:0:s.vars.dataCustomer?s.vars.dataCustomer.total:0)>0){i=s.renderDataContent(e,t,0,s.vars.size),d.removeClass(n.hidden).html(i);var u=e.data.length>d.children().length;u&&r.removeClass(n.hidden),!u&&r.addClass(n.hidden)}var f=""!==s.searchInput.val().trim()?"'"+s.searchInput.val().trim()+"'":"",p="",h=t===s.vars.stringPolicy?t+" number":t;a?(m.addClass(n.hidden),l.removeClass(n.hidden),a>s.vars.maxSize&&c.removeClass(n.hidden),p=t===s.vars.stringNational?this.tabResult.find("[data-id=template-"+t+"]").html():this.tabResult.find("[data-id=template-global]").html(),a>1&&t===s.vars.stringPolicy&&(h=t+" number(s)"),a>1&&t!==s.vars.stringPolicy&&(h=t+"(s)"),p=p.replace("{{TOTAL}}","<strong>"+a+"</strong>").replace("{{SEARCHTEXT}}",'<strong class="searchText"></strong>').replace("{{TYPE}}",h),l.html(p),l.find(".searchText").text(s.escapeXssCharacter(f))):(l.addClass(n.hidden),m.removeClass(n.hidden),p=(p=t===s.vars.stringNational?this.tabResult.find("[data-id=template-no-result-"+t+"]").html():this.tabResult.find("[data-id=template-no-result-global]").html()).replace("{{TOTAL}}","<strong>"+a+"</strong>").replace("{{SEARCHTEXT}}","<strong>"+s.escapeXssCharacter(f)+"</strong>").replace("{{TYPE}}",h),m.html(p))},escapeXssCharacter:function(e){return encodeURI(e).replace(/%20/g," ")},renderDataContent:function(a,i,s,n){var o,d=this,r=d.options,l=r.customerLink+"?sgServicePortalCustomerId=",c=e(d.template.customer).html();return i===d.vars.stringPolicy&&(l=r.policyLink+"?policyId=",c=e(d.template.policy).html()),c=c.replace(/{{SubmitRequest}}/g,r.btnsubmitRequest).replace("{{SubmitClaim}}",r.btnsubmitClaim).replace("{{CustomerDateText}}",r.customerDateText).replace("{{PolicyOwnerText}}",r.policyOwnerText).replace(/{{Link}}/g,l).replace("{{URLREDIRECTPAGE}}",d.element.data("url-redirect-page")).replace("{{URLSUBMITPOS}}",d.element.data("url-submit-pos")),o=d.getDataItem(a.data,s,n),t.Handlebars.compile(c)(o)},getDataItem:function(t,a,i){var s=[];return e.each(t,function(e,t){e>=a&&e<i&&s.push(t)}),s},loadMoreContent:function(e){var t,a=this,i=a.options.class,s=a.vars.dataCustomer,n=e===a.vars.stringPolicy?a.contentPolicy:a.contentCustomer,o=n.find(".result-table"),d=n.find("[data-id=show-more]"),r=o.children().length;e===a.vars.stringPolicy&&(s=a.vars.dataPolicy),t=a.renderDataContent(s,e,r,r+a.vars.size),o.append(t);var l=s.data.length>o.children().length;l&&d.removeClass(i.hidden),!l&&d.addClass(i.hidden)},showLoading:function(e){var t=this.options.class;this.loading.removeClass(t.hidden),e.addClass(t.hidden)},hideLoading:function(){var e=this.options.class;this.loading.addClass(e.hidden),this.tabNav.removeClass(e.hidden)},sendFormCustomer:function(e){var a=this,i={customerId:e.customerId,customerName:e.customerName,customerGender:e.customerGender};Site.ajaxUtil(a.options.urlSubmitPos,a.vars.method,"json",JSON.stringify(i),function(e){200===e.statusCode&&(t.location.href=a.options.urlRedirectPage+"?sgServicePortalSubmitRef="+e.submitRef)},function(e){throw e})},sendFormPolicy:function(e){var a=this,i={customerId:e.customerId,customerName:e.customerName,customerGender:e.customerGender,policyId:e.policyId,sourceSystem:e.sourceSystem};Site.ajaxUtil(a.options.urlSubmitPos,a.vars.method,"json",JSON.stringify(i),function(e){200===e.statusCode&&(t.location.href=a.options.urlRedirectPage+"?sgServicePortalSubmitRef="+e.submitRef)},function(e){throw e})},callAjaxFail:function(e){var t=this.options.class;this.tabNav.removeClass(t.hidden),e.find("[data-id=count-result]").addClass(t.hidden),e.find("[data-id=notify-max-result]").addClass(t.hidden),e.find("[data-id=no-result]").addClass(t.hidden),e.find("[data-id=error-result]").removeClass(t.hidden),this.loading.addClass(t.hidden)},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var s=e.data(this,i);s?s[t]&&s[t](a):e.data(this,i,new o(this,t))})},e.fn[i].defaults={class:{active:"active",hidden:"hidden",open:"open",resultTable:"result-table"}},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window),function(e,t,a){"use strict";var i,s="sms-handle",n=t.Site,o=n.vars.assetPath,d={click:"click."+s},r=function(e){var t=e.confirm?'<button class="btn btn-default '+e.confirm.class+' margin-left-xxs" type="button" data-toggle="modal" data-dismiss="modal" data-id="'+e.confirm.id+'">'+e.confirm.title+"</button>":"",a=n.vars.bodyElem.find("[data-id=common-popup]");a.html('<div class="modal-dialog partial-screen-modal-dialog"><div class="modal-content overflow-auto"><div class="modal-header bg-t2"><button class="modal-header-btn pull-left" data-dismiss="modal"><svg class="icon-xs hide-on-fallback" role="img" title="closewhite-glyph"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="'+o+'icons/icons.svg#closewhite-glyph"></use><image class="icon-fallback" alt="closewhite-glyph" src="'+o+'closewhite-glyph.png" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href=""></image></svg>  </button><h6 class="w text-center">'+e.title+'</h6></div><div class="modal-container padding-top-xxl content-centering"><p class="content-centering bt2">'+e.description+'</p><div class="margin-bottom-l margin-top-xxl"><button class="btn btn-default '+e.decline.class+'" type="button" data-dismiss="modal" data-id="'+e.decline.id+'">'+e.decline.title+"</button>"+t+"</div></div></div></div>"),a.off("hidden.bs.modal").on("hidden.bs.modal",e.decline.func),e.confirm&&n.vars.bodyElem.off(d.click,"[data-id="+e.confirm.id+"]").on(d.click,"[data-id="+e.confirm.id+"]",e.confirm.func),a.modal("show")};function l(t,a){this.element=e(t),this.options=e.extend({},e.fn[s].defaults,this.element.data(),a),this.init()}l.prototype={init:function(){var a=this,i=a.options,s=a.element,o=!1,r=s.find("button[type=submit]");a.countSubmit=1,a.smsForm=s,a.modalaiaOTP=s.parents("[data-sms-popup]"),a.smsForm.find('[name="device-id"]').off("keyup").on("keyup",function(){e(this).attr({"data-parsley-required":!0,"data-parsley-group":"block-otp","data-parsley-type":"number","data-parsley-error-message":"Please enter a valid number."});var t=a.smsForm.find('[name="device-code"]').val()+"-"+e(this).val();a.smsForm.find('[name="device-id-full"]').val(t)}),a.smsForm.off("submit").on("submit",function(t){if(t.preventDefault(),o)return!1;o=!0,e(this).parsley().validate();var d={},l=i.aiaOtpType||i.onekeySMSType||i.onekeySMSLinkType||!1;if(i.aiaOtpType?d={customerId:i.customerId,userId:i.userId,userOtp:a.smsForm.find("input").val(),tokenUUID:a.tokenUUID,submitRef:i.submitRef||""}:i.onekeySMSType?d={customerId:i.customerId,serialNum:i.serialNum,vendorId:i.vendorId,challenge:a.challengeToken,otp:a.smsForm.find("input").val(),submitRef:i.submitRef||""}:i.onekeyHardwareType?d={customerId:i.customerId,serialNum:i.serialNum,vendorId:i.vendorId,otp:a.smsForm.find("input").val(),submitRef:i.submitRef||""}:i.onekeySMSLinkType?d={customerId:i.customerId,deviceId:a.smsForm.find("input[name=device-id-full]").val(),challenge:a.challengeToken,otp:a.smsForm.find("input[name=otp-code]").val()}:i.onekeyHardwareLinkType&&(d={customerId:i.customerId,deviceId:a.smsForm.find("input[name=device-id-full]").val(),otp:a.smsForm.find("input[name=otp-code]").val()}),a.smsForm.parsley().isValid()){r.prop("disabled",!0);var c={type:"token"};if(!i.aiaOtpType&&(c.deviceId=i.deviceId),i.onekeyHardwareType||(c.phoneNo=i.customerPhone,c.type="sms"),l&&a.countSubmit>=i.numberVerifyOtp)return!1;n.ajaxUtil(a.smsForm.data("verify-otp"),i.method||"POST","json",JSON.stringify(d),function(e){if(s.data("otp-token",a.smsForm.find("input").val()),200!==e.statusCode){var t=e.data&&(e.data.detailMessage||e.data.detailMessage)||e.message;return l&&a.countSubmit++,7999===e.statusCode&&(i.onekeySMSLinkType||i.onekeyHardwareLinkType)?(o=!1,"function"==typeof i.verifyCallbackUnLinked&&i.verifyCallbackUnLinked(e),!1):10401===e.statusCode&&(i.onekeySMSType||i.onekeyHardwareType)?(o=!1,"function"==typeof i.callBackGetLinked&&i.callBackGetLinked(t),!1):(l&&a.countSubmit>=i.numberVerifyOtp&&(t="The code entered is incorrect. As you have exceeded the maximum number of tries, OTP code is no longer possible. Please get a new OTP.",r.attr("disabled",!0),o=!0),t&&a.smsForm.find("[data-id=verify-fail]").text(t),t&&a.smsForm.find("[data-id=verify-fail]").removeClass("hidden"),!1)}"function"==typeof i.verifyCallback&&i.verifyCallback(c),a.smsForm.find("input").val(""),o=!1,a.countSubmit<i.numberVerifyOtp&&r.attr("disabled",!1)},function(e,t){o=!1;var s=e.data&&(e.data.detailMessage||e.data.message)||e.message;if(l&&a.countSubmit++,7999===e.statusCode&&(i.onekeySMSLinkType||i.onekeyHardwareLinkType))return"function"==typeof i.verifyCallbackUnLinked&&i.verifyCallbackUnLinked(e),!1;if(10401===e.statusCode&&(i.onekeySMSType||i.onekeyHardwareType))return"function"==typeof i.callBackGetLinked&&i.callBackGetLinked(s),!1;if(t&&0===t)return a.smsForm.find("[data-id=verify-fail]").text("No connections are available. Plaese try again."),!1;throw l&&a.countSubmit>=i.numberVerifyOtp&&(s="The code entered is incorrect. As you have exceeded the maximum number of tries, OTP code is no longer possible. Please get a new OTP.",r.attr("disabled",!0),o=!0),s&&a.smsForm.find("[data-id=verify-fail]").text(s),"function"==typeof i.verifyErrorCallBack&&i.verifyErrorCallBack(e),a.smsForm.find("[data-id=verify-fail]").removeClass("hidden"),a.countSubmit<i.numberVerifyOtp&&r.attr("disabled",!1),o=!1,e},i.headerParams)}else o=!1}),a.smsForm.find("[data-id=resend-otp]").off(d.click).on(d.click,function(i){i.preventDefault();var s=e(this).parents("[data-is-mobile]").length,o=a.smsForm.find('[name="device-id-full"]').val();if(!a.smsForm.parsley().validate({group:"device-id"}))return!1;s?(t.sessionStorage.setItem("newSerialNum",o),n.vars.winElem.unbind("beforeunload.AIA"),t.location.reload()):(a.options.isRegenerate=!0,a.options.newSerialNum=o,a.options.isDesktop=!0,a.handleGenerateOTP())})},handleGenerateOTP:function(){var a=this,i=a.options,s={},o=5,d=!1,l=a.element.find("button[type=submit]"),c=i.onekeyHardwareType||i.onekeyHardwareLinkType,m=a.smsForm.parents("[data-is-mobile]").length;if(d)return!1;if(a.countSubmit=0,d=!0,l.prop("disabled",!0),i.aiaOtpType?(o=e("[data-aia-sms-expired]").data("aia-sms-expired"),s={customerId:i.customerId,userId:i.userId,isRegenerate:i.isRegenerate}):i.onekeySMSType?(o=e("[data-onekey-sms-expired]").data("onekey-sms-expired"),s={customerId:i.customerId,serialNum:i.serialNum,vendorId:i.vendorId,link:"false"}):c?o=e("[data-onekey-hardware-expired]").data("onekey-hardware-expired"):i.onekeySMSLinkType&&(o=e("[data-onekey-sms-expired]").data("onekey-sms-expired"),i.isRegenerate&&i.isDesktop&&i.newSerialNum&&(i.serialNum=i.newSerialNum),m&&t.sessionStorage.newSerialNum&&"undefined"!==t.sessionStorage.newSerialNum&&""!==t.sessionStorage.newSerialNum&&(i.serialNum=t.sessionStorage.newSerialNum),s={customerId:i.customerId,serialNum:i.serialNum,vendorId:i.vendorId,link:!0}),a.smsForm.find("[data-id=verify-fail]").addClass("hidden"),a.smsForm.find("[data-id=expired-otp]").addClass("hidden"),!1,c){if(i.onekeyHardwareLinkType)if(i.serialNum){var u=i.serialNum.split("-");a.smsForm.find('[data-id=mobile-number] [name="device-code"]').val(u[0]),a.smsForm.find('[data-id=mobile-number] [name="device-id"]').val(u[1].replace(u[1].slice(0,4),"XXXX")).removeAttr("data-parsley-required data-parsley-group data-parsley-type ata-parsley-error-message"),a.smsForm.find('[data-id=mobile-number] [name="device-id-full"]').val(i.serialNum)}else a.smsForm.find("[name=device-code]").removeClass("bg-b4").prop("disabled",!1),a.smsForm.find("[name=device-code]").attr({maxlength:"4",placeholder:"VA/VB","data-parsley-required":"true","data-parsley-error-message":"","data-parsley-group":"device-id"}),a.smsForm.find("[name=device-id]").attr({"data-parsley-required":"true","data-parsley-error-message":"Please input device id.","data-parsley-group":"device-id"});else{var f=i.deviceId.replace(i.deviceId.slice(5,9),"-XXXX").replace(i.deviceId.slice(i.deviceId.length-1,i.deviceId.length),"-")+i.deviceId[i.deviceId.length-1];a.smsForm.find("[data-id=serial-number]").html("<strong>"+f+"</strong>")}l.prop("disabled",!1)}var p=function(t){var a=t.data&&t.data.message||t.message;r({title:"Warning",description:a,decline:{id:"close",title:"close",class:"btn-secondary",func:function(){e("body").find("[data-is-mobile]").length&&(n.vars.winElem.unbind("beforeunload.AIA"),history.back())}}}),d=!1,l.prop("disabled",!1)},h=function(t){var s=t.data&&t.data.message&&t.data.message.split("=")||"";if(m&&e(".loading").addClass("hidden"),a.smsForm.find('input[name="challenge-code"]').val(s[1]||"").attr("disabled",!0).addClass("bg-b4"),i.serialNum){var n=i.serialNum.split("-");a.smsForm.find('[data-id=mobile-number] [name="device-code"]').val(n[0]),a.smsForm.find('[data-id=mobile-number] [name="device-id"]').val(n[1].replace(n[1].slice(0,4),"XXXX")).removeAttr("data-parsley-required data-parsley-group data-parsley-type ata-parsley-error-message"),a.smsForm.find('[data-id=mobile-number] [name="device-id-full"]').val(i.serialNum)}else{var o=t.data&&t.data.message||t.message;r({title:"Warning",description:o+"</br>Please choose a device Id other.",decline:{id:"close",title:"close",class:"btn-secondary",func:function(){a.smsForm.find('[data-id=mobile-number] [name="device-code"]').removeClass("bg-b4").prop("disabled",!1),a.smsForm.find("[name=device-code]").attr({maxlength:"4",placeholder:"VA/VB","data-parsley-required":"true","data-parsley-error-message":"","data-parsley-group":"device-id"}),a.smsForm.find("[name=device-id]").attr({"data-parsley-required":"true","data-parsley-error-message":"Please input device id.","data-parsley-group":"device-id"})}}})}};!c&&n.ajaxUtil(i.api,i.method||"POST","json",JSON.stringify(s),function(e){if(200!==e.statusCode){if(10401!==e.statusCode)return p(e,i.onekeySMSLinkType),!1;if(!i.onekeySMSLinkType){var t=e.data&&e.data.message||e.message;return"function"==typeof i.callBackGetLinked&&i.callBackGetLinked(t),!1}h(e),d=!1,l.prop("disabled",!1)}(i.onekeySMSType||i.onekeySMSLinkType)&&(a.challengeToken=e.data.challengeToken),"function"==typeof i.generateCallback&&i.generateCallback(),i.onekeySMSLinkType&&h(e),(i.aiaOtpType||i.onekeySMSType)&&(i.customerPhone=e.data.customerPhone,a.smsForm.find("[data-id=mobile-number]").html("<strong>"+i.customerPhone.replace(i.customerPhone.slice(0,4),"XXXX")+"</strong>")),o&&a.countDown(o),i.aiaOtpType&&(a.tokenUUID=e.data.tokenUUID||""),d=!1,l.prop("disabled",!1)},function(e){if(i.onekeySMSLinkType)return h(e),d=!1,l.prop("disabled",!1),!1;if(10401===e.statusCode){var t=e.data&&e.data.message||e.message;return"function"==typeof i.callBackGetLinked&&i.callBackGetLinked(t),!1}p(e)},i.headerParams)},countDown:function(e){var t=this;clearTimeout(i);var a=function(e){var s=60,n=e,o=t.smsForm.find("[data-id=validation-otp]").removeClass("hidden"),d=o.find("[data-id=count-otp]").removeClass("u2"),r=t.smsForm.find("[data-id=expired-otp]").addClass("hidden"),l=function(){var e=n-1;s--,e>0?d.text(e.toString()+"m"+(s<10?"0":"")+String(s)+"s"):d.text((s<10?"0":"")+String(s)+"s"),s>0?(s<=5&&e<=0&&!d.hasClass("u2")&&d.addClass("u2"),i=setTimeout(l,1e3)):n>1?a(n-1):(r.removeClass("hidden"),o.addClass("hidden"))};l()};a(e),!0},destroy:function(){e.removeData(this.element[0],s)}},e.fn[s]=function(t,a){return this.each(function(){var i=e.data(this,s);i?i[t]&&i[t](a):e.data(this,s,new l(this,t))})},e.fn[s].defaults={expired:!0,headerParams:"undefined",numberVerifyOtp:3},e(function(){e("[data-"+s+"]")[s]({})})}(jQuery,window),function(e,t,a){"use strict";var i="view-pdf";function s(t,a){this.element=e(t),this.options=e.extend({},e.fn[i].defaults,this.element.data(),a),this.init()}s.prototype={init:function(){var a=this,i=a.element.data("pdf-path"),s=a.element.siblings("[data-id=no-result]"),n=e("html.ios")&&t.innerWidth<1025?{scale:1.1}:{scale:1.3};a.element.addClass("bg-b8").html(""),i&&a.renderPDF(i,a.element,n,function(){a.element.removeClass("bg-b8 pdf-view"),s.removeClass("hidden")})},renderPDF:function(a,i,s,n){var o,d,r,l,c=s||{scale:1.3},m=e.Deferred().resolve().promise(),u=function(e,t){return function(){return e.call(null,t)}};function f(t){var a=e.Deferred(),s=new function(e){var t=e;return function(){return t}}(t);return d.getPage(s()).then(function(e){var t=e.getViewport(c.scale),n=document.createElement("canvas"),o={canvasContext:n.getContext("2d"),viewport:t};1===s()&&(l=t.height,r=t.width),n.height=l,n.width=r,i.append(n),e.render(o).then(function(){a.resolve()})}),a.promise()}t.PDFJS.disableWorker=!0,t.PDFJS.getDocument(a).then(function(e){for(var t=(d=e).numPages,a=1;a<=t;a++)o=f,m=m.then(u(o,a))}).catch(function(e){throw"function"==typeof n&&n(),e})},destroy:function(){e.removeData(this.element[0],i)}},e.fn[i]=function(t,a){return this.each(function(){var n=e.data(this,i);n?n[t]&&n[t](a):e.data(this,i,new s(this,t))})},e.fn[i].defaults={pdfPath:""},e(function(){e("[data-"+i+"]")[i]()})}(jQuery,window);